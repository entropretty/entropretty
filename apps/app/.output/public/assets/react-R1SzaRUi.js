import{W as ee,r as D}from"./main-D_QOtJ75.js";const L={},Y=(e,n)=>e.unstable_is?e.unstable_is(n):n===e,Z=e=>"init"in e,G=e=>!!e.write,F=e=>"v"in e||"e"in e,N=e=>{if("e"in e)throw e.e;if((L?"production":void 0)!=="production"&&!("v"in e))throw new Error("[Bug] atom state is not initialized");return e.v},j=new WeakMap,B=e=>{var n;return U(e)&&!!((n=j.get(e))!=null&&n[0])},oe=e=>{const n=j.get(e);n?.[0]&&(n[0]=!1,n[1].forEach(r=>r()))},te=(e,n)=>{let r=j.get(e);if(!r){r=[!0,new Set],j.set(e,r);const l=()=>{r[0]=!1};e.then(l,l)}r[1].add(n)},U=e=>typeof e?.then=="function",ne=(e,n,r)=>{r.p.has(e)||(r.p.add(e),n.then(()=>{r.p.delete(e)},()=>{r.p.delete(e)}))},K=(e,n,r)=>{const l=r(e),f="v"in l,h=l.v;if(U(n))for(const _ of l.d.keys())ne(e,n,r(_));l.v=n,delete l.e,(!f||!Object.is(h,l.v))&&(++l.n,U(h)&&oe(h))},k=(e,n,r)=>{var l;const f=new Set;for(const h of((l=r.get(e))==null?void 0:l.t)||[])r.has(h)&&f.add(h);for(const h of n.p)f.add(h);return f},ce=Symbol(),le=(e=new WeakMap,n=new WeakMap,r=new WeakMap,l=new Set,f=new Set,h=new Set,_={},P=(a,...p)=>a.read(...p),E=(a,...p)=>a.write(...p),d=(a,p)=>{var b;return(b=a.unstable_onInit)==null?void 0:b.call(a,p)},S=(a,p)=>{var b;return(b=a.onMount)==null?void 0:b.call(a,p)},...y)=>{const a=y[0]||(t=>{if((L?"production":void 0)!=="production"&&!t)throw new Error("Atom is undefined or null");let u=e.get(t);return u||(u={d:new Map,p:new Set,n:0},e.set(t,u),d?.(t,$)),u}),p=y[1]||(()=>{const t=[],u=c=>{try{c()}catch(i){t.push(i)}};do{_.f&&u(_.f);const c=new Set,i=c.add.bind(c);l.forEach(s=>{var o;return(o=n.get(s))==null?void 0:o.l.forEach(i)}),l.clear(),h.forEach(i),h.clear(),f.forEach(i),f.clear(),c.forEach(u),l.size&&b()}while(l.size||h.size||f.size);if(t.length)throw new AggregateError(t)}),b=y[2]||(()=>{const t=[],u=new WeakSet,c=new WeakSet,i=Array.from(l);for(;i.length;){const s=i[i.length-1],o=a(s);if(c.has(s)){i.pop();continue}if(u.has(s)){if(r.get(s)===o.n)t.push([s,o]);else if((L?"production":void 0)!=="production"&&r.has(s))throw new Error("[Bug] invalidated atom exists");c.add(s),i.pop();continue}u.add(s);for(const w of k(s,o,n))u.has(w)||i.push(w)}for(let s=t.length-1;s>=0;--s){const[o,w]=t[s];let g=!1;for(const T of w.d.keys())if(T!==o&&l.has(T)){g=!0;break}g&&(A(o),W(o)),r.delete(o)}}),A=y[3]||(t=>{var u;const c=a(t);if(F(c)&&(n.has(t)&&r.get(t)!==c.n||Array.from(c.d).every(([v,z])=>A(v).n===z)))return c;c.d.clear();let i=!0;const s=()=>{n.has(t)&&(W(t),b(),p())},o=v=>{var z;if(Y(t,v)){const X=a(v);if(!F(X))if(Z(v))K(v,v.init,a);else throw new Error("no atom init");return N(X)}const C=A(v);try{return N(C)}finally{c.d.set(v,C.n),B(c.v)&&ne(t,c.v,C),(z=n.get(v))==null||z.t.add(t),i||s()}};let w,g;const T={get signal(){return w||(w=new AbortController),w.signal},get setSelf(){return(L?"production":void 0)!=="production"&&!G(t)&&console.warn("setSelf function cannot be used with read-only atom"),!g&&G(t)&&(g=(...v)=>{if((L?"production":void 0)!=="production"&&i&&console.warn("setSelf function cannot be called in sync"),!i)try{return R(t,...v)}finally{b(),p()}}),g}},x=c.n;try{const v=P(t,o,T);return K(t,v,a),U(v)&&(te(v,()=>w?.abort()),v.then(s,s)),c}catch(v){return delete c.v,c.e=v,++c.n,c}finally{i=!1,x!==c.n&&r.get(t)===x&&(r.set(t,c.n),l.add(t),(u=_.c)==null||u.call(_,t))}}),J=y[4]||(t=>{const u=[t];for(;u.length;){const c=u.pop(),i=a(c);for(const s of k(c,i,n)){const o=a(s);r.set(s,o.n),u.push(s)}}}),R=y[5]||((t,...u)=>{let c=!0;const i=o=>N(A(o)),s=(o,...w)=>{var g;const T=a(o);try{if(Y(t,o)){if(!Z(o))throw new Error("atom not writable");const x=T.n,v=w[0];K(o,v,a),W(o),x!==T.n&&(l.add(o),(g=_.c)==null||g.call(_,o),J(o));return}else return R(o,...w)}finally{c||(b(),p())}};try{return E(t,i,s,...u)}finally{c=!1}}),W=y[6]||(t=>{var u;const c=a(t),i=n.get(t);if(i&&!B(c.v)){for(const[s,o]of c.d)if(!i.d.has(s)){const w=a(s);O(s).t.add(t),i.d.add(s),o!==w.n&&(l.add(s),(u=_.c)==null||u.call(_,s),J(s))}for(const s of i.d||[])if(!c.d.has(s)){i.d.delete(s);const o=V(s);o?.t.delete(t)}}}),O=y[7]||(t=>{var u;const c=a(t);let i=n.get(t);if(!i){A(t);for(const s of c.d.keys())O(s).t.add(t);if(i={l:new Set,d:new Set(c.d.keys()),t:new Set},n.set(t,i),(u=_.m)==null||u.call(_,t),G(t)){const s=()=>{let o=!0;const w=(...g)=>{try{return R(t,...g)}finally{o||(b(),p())}};try{const g=S(t,w);g&&(i.u=()=>{o=!0;try{g()}finally{o=!1}})}finally{o=!1}};f.add(s)}}return i}),V=y[8]||(t=>{var u;const c=a(t);let i=n.get(t);if(i&&!i.l.size&&!Array.from(i.t).some(s=>{var o;return(o=n.get(s))==null?void 0:o.d.has(t)})){i.u&&h.add(i.u),i=void 0,n.delete(t),(u=_.u)==null||u.call(_,t);for(const s of c.d.keys()){const o=V(s);o?.t.delete(t)}return}return i}),ie=[e,n,r,l,f,h,_,P,E,d,S,a,p,b,A,J,R,W,O,V],$={get:t=>N(A(t)),set:(t,...u)=>{try{return R(t,...u)}finally{b(),p()}},sub:(t,u)=>{const i=O(t).l;return i.add(u),p(),()=>{i.delete(u),V(t),p()}}};return Object.defineProperty($,ce,{value:ie}),$},ue=le,H=te,re={};let fe=0;function be(e,n){const r=`atom${++fe}`,l={toString(){return(re?"production":void 0)!=="production"&&this.debugLabel?r+":"+this.debugLabel:r}};return typeof e=="function"?l.read=e:(l.init=e,l.read=de,l.write=ae),n&&(l.write=n),l}function de(e){return e(this)}function ae(e,n,r){return n(this,typeof r=="function"?r(e(this)):r)}function ve(){return ue()}let I;function he(){return I||(I=ve(),(re?"production":void 0)!=="production"&&(globalThis.__JOTAI_DEFAULT_STORE__||(globalThis.__JOTAI_DEFAULT_STORE__=I),globalThis.__JOTAI_DEFAULT_STORE__!==I&&console.warn("Detected multiple Jotai instances. It may cause unexpected behavior with the default store. https://github.com/pmndrs/jotai/discussions/2044"))),I}const _e={},we=D.createContext(void 0);function se(e){return D.useContext(we)||he()}const q=e=>typeof e?.then=="function",Q=e=>{e.status||(e.status="pending",e.then(n=>{e.status="fulfilled",e.value=n},n=>{e.status="rejected",e.reason=n}))},Se=ee.use||(e=>{if(e.status==="pending")throw e;if(e.status==="fulfilled")return e.value;throw e.status==="rejected"?e.reason:(Q(e),e)}),M=new WeakMap,m=(e,n)=>{let r=M.get(e);return r||(r=new Promise((l,f)=>{let h=e;const _=d=>S=>{h===d&&l(S)},P=d=>S=>{h===d&&f(S)},E=()=>{try{const d=n();q(d)?(M.set(d,r),h=d,d.then(_(d),P(d)),H(d,E)):l(d)}catch(d){f(d)}};e.then(_(e),P(e)),H(e,E)}),M.set(e,r)),r};function ye(e,n){const{delay:r,unstable_promiseStatus:l=!ee.use}={},f=se(),[[h,_,P],E]=D.useReducer(S=>{const y=f.get(e);return Object.is(S[0],y)&&S[1]===f&&S[2]===e?S:[y,f,e]},void 0,()=>[f.get(e),f,e]);let d=h;if((_!==f||P!==e)&&(E(),d=f.get(e)),D.useEffect(()=>{const S=f.sub(e,()=>{if(l)try{const y=f.get(e);q(y)&&Q(m(y,()=>f.get(e)))}catch{}if(typeof r=="number"){setTimeout(E,r);return}E()});return E(),S},[f,e,r,l]),D.useDebugValue(d),q(d)){const S=m(d,()=>f.get(e));return l&&Q(S),Se(S)}return d}function pe(e,n){const r=se();return D.useCallback((...f)=>{if((_e?"production":void 0)!=="production"&&!("write"in e))throw new Error("not writable atom");return r.set(e,...f)},[r,e])}function Ee(e,n){return[ye(e),pe(e)]}export{be as a,Ee as b,pe as c,ye as u};
