function xe(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var q,se;function ve(){if(se)return q;se=1;const e="Input must be an string, Buffer or Uint8Array";function t(h){let u;if(h instanceof Uint8Array)u=h;else if(typeof h=="string")u=new TextEncoder().encode(h);else throw new Error(e);return u}function r(h){return Array.prototype.map.call(h,function(u){return(u<16?"0":"")+u.toString(16)}).join("")}function o(h){return(4294967296+h).toString(16).substring(1)}function a(h,u,f){let d=`
`+h+" = ";for(let y=0;y<u.length;y+=2){if(f===32)d+=o(u[y]).toUpperCase(),d+=" ",d+=o(u[y+1]).toUpperCase();else if(f===64)d+=o(u[y+1]).toUpperCase(),d+=o(u[y]).toUpperCase();else throw new Error("Invalid size "+f);y%6===4?d+=`
`+new Array(h.length+4).join(" "):y<u.length-2&&(d+=" ")}console.log(d)}function l(h,u,f){let d=new Date().getTime();const y=new Uint8Array(u);for(let w=0;w<u;w++)y[w]=w%256;const g=new Date().getTime();console.log("Generated random input in "+(g-d)+"ms"),d=g;for(let w=0;w<f;w++){const x=h(y),s=new Date().getTime(),m=s-d;d=s,console.log("Hashed in "+m+"ms: "+x.substring(0,20)+"..."),console.log(Math.round(u/(1<<20)/(m/1e3)*100)/100+" MB PER SECOND")}}return q={normalizeInput:t,toHex:r,debugPrint:a,testSpeed:l},q}var L,ie;function qe(){if(ie)return L;ie=1;const e=ve();function t(i,b,n){const p=i[b]+i[n];let v=i[b+1]+i[n+1];p>=4294967296&&v++,i[b]=p,i[b+1]=v}function r(i,b,n,p){let v=i[b]+n;n<0&&(v+=4294967296);let E=i[b+1]+p;v>=4294967296&&E++,i[b]=v,i[b+1]=E}function o(i,b){return i[b]^i[b+1]<<8^i[b+2]<<16^i[b+3]<<24}function a(i,b,n,p,v,E){const A=d[v],k=d[v+1],M=d[E],H=d[E+1];t(f,i,b),r(f,i,A,k);let S=f[p]^f[i],C=f[p+1]^f[i+1];f[p]=C,f[p+1]=S,t(f,n,p),S=f[b]^f[n],C=f[b+1]^f[n+1],f[b]=S>>>24^C<<8,f[b+1]=C>>>24^S<<8,t(f,i,b),r(f,i,M,H),S=f[p]^f[i],C=f[p+1]^f[i+1],f[p]=S>>>16^C<<16,f[p+1]=C>>>16^S<<16,t(f,n,p),S=f[b]^f[n],C=f[b+1]^f[n+1],f[b]=C>>>31^S<<1,f[b+1]=S>>>31^C<<1}const l=new Uint32Array([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),h=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3],u=new Uint8Array(h.map(function(i){return i*2})),f=new Uint32Array(32),d=new Uint32Array(32);function y(i,b){let n=0;for(n=0;n<16;n++)f[n]=i.h[n],f[n+16]=l[n];for(f[24]=f[24]^i.t,f[25]=f[25]^i.t/4294967296,b&&(f[28]=~f[28],f[29]=~f[29]),n=0;n<32;n++)d[n]=o(i.b,4*n);for(n=0;n<12;n++)a(0,8,16,24,u[n*16+0],u[n*16+1]),a(2,10,18,26,u[n*16+2],u[n*16+3]),a(4,12,20,28,u[n*16+4],u[n*16+5]),a(6,14,22,30,u[n*16+6],u[n*16+7]),a(0,10,20,30,u[n*16+8],u[n*16+9]),a(2,12,22,24,u[n*16+10],u[n*16+11]),a(4,14,16,26,u[n*16+12],u[n*16+13]),a(6,8,18,28,u[n*16+14],u[n*16+15]);for(n=0;n<16;n++)i.h[n]=i.h[n]^f[n]^f[n+16]}const g=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);function w(i,b,n,p){if(i===0||i>64)throw new Error("Illegal output length, expected 0 < length <= 64");if(b&&b.length>64)throw new Error("Illegal key, expected Uint8Array with 0 < length <= 64");if(n&&n.length!==16)throw new Error("Illegal salt, expected Uint8Array with length is 16");if(p&&p.length!==16)throw new Error("Illegal personal, expected Uint8Array with length is 16");const v={b:new Uint8Array(128),h:new Uint32Array(16),t:0,c:0,outlen:i};g.fill(0),g[0]=i,b&&(g[1]=b.length),g[2]=1,g[3]=1,n&&g.set(n,32),p&&g.set(p,48);for(let E=0;E<16;E++)v.h[E]=l[E]^o(g,E*4);return b&&(x(v,b),v.c=128),v}function x(i,b){for(let n=0;n<b.length;n++)i.c===128&&(i.t+=i.c,y(i,!1),i.c=0),i.b[i.c++]=b[n]}function s(i){for(i.t+=i.c;i.c<128;)i.b[i.c++]=0;y(i,!0);const b=new Uint8Array(i.outlen);for(let n=0;n<i.outlen;n++)b[n]=i.h[n>>2]>>8*(n&3);return b}function m(i,b,n,p,v){n=n||64,i=e.normalizeInput(i),p&&(p=e.normalizeInput(p)),v&&(v=e.normalizeInput(v));const E=w(n,b,p,v);return x(E,i),s(E)}function c(i,b,n,p,v){const E=m(i,b,n,p,v);return e.toHex(E)}return L={blake2b:m,blake2bHex:c,blake2bInit:w,blake2bUpdate:x,blake2bFinal:s},L}var V,oe;function Le(){if(oe)return V;oe=1;const e=ve();function t(s,m){return s[m]^s[m+1]<<8^s[m+2]<<16^s[m+3]<<24}function r(s,m,c,i,b,n){h[s]=h[s]+h[m]+b,h[i]=o(h[i]^h[s],16),h[c]=h[c]+h[i],h[m]=o(h[m]^h[c],12),h[s]=h[s]+h[m]+n,h[i]=o(h[i]^h[s],8),h[c]=h[c]+h[i],h[m]=o(h[m]^h[c],7)}function o(s,m){return s>>>m^s<<32-m}const a=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),l=new Uint8Array([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0]),h=new Uint32Array(16),u=new Uint32Array(16);function f(s,m){let c=0;for(c=0;c<8;c++)h[c]=s.h[c],h[c+8]=a[c];for(h[12]^=s.t,h[13]^=s.t/4294967296,m&&(h[14]=~h[14]),c=0;c<16;c++)u[c]=t(s.b,4*c);for(c=0;c<10;c++)r(0,4,8,12,u[l[c*16+0]],u[l[c*16+1]]),r(1,5,9,13,u[l[c*16+2]],u[l[c*16+3]]),r(2,6,10,14,u[l[c*16+4]],u[l[c*16+5]]),r(3,7,11,15,u[l[c*16+6]],u[l[c*16+7]]),r(0,5,10,15,u[l[c*16+8]],u[l[c*16+9]]),r(1,6,11,12,u[l[c*16+10]],u[l[c*16+11]]),r(2,7,8,13,u[l[c*16+12]],u[l[c*16+13]]),r(3,4,9,14,u[l[c*16+14]],u[l[c*16+15]]);for(c=0;c<8;c++)s.h[c]^=h[c]^h[c+8]}function d(s,m){if(!(s>0&&s<=32))throw new Error("Incorrect output length, should be in [1, 32]");const c=m?m.length:0;if(m&&!(c>0&&c<=32))throw new Error("Incorrect key length, should be in [1, 32]");const i={h:new Uint32Array(a),b:new Uint8Array(64),c:0,t:0,outlen:s};return i.h[0]^=16842752^c<<8^s,c>0&&(y(i,m),i.c=64),i}function y(s,m){for(let c=0;c<m.length;c++)s.c===64&&(s.t+=s.c,f(s,!1),s.c=0),s.b[s.c++]=m[c]}function g(s){for(s.t+=s.c;s.c<64;)s.b[s.c++]=0;f(s,!0);const m=new Uint8Array(s.outlen);for(let c=0;c<s.outlen;c++)m[c]=s.h[c>>2]>>8*(c&3)&255;return m}function w(s,m,c){c=c||32,s=e.normalizeInput(s);const i=d(c,m);return y(i,s),g(i)}function x(s,m,c){const i=w(s,m,c);return e.toHex(i)}return V={blake2s:w,blake2sHex:x,blake2sInit:d,blake2sUpdate:y,blake2sFinal:g},V}var Y,ae;function Ve(){if(ae)return Y;ae=1;const e=qe(),t=Le();return Y={blake2b:e.blake2b,blake2bHex:e.blake2bHex,blake2bInit:e.blake2bInit,blake2bUpdate:e.blake2bUpdate,blake2bFinal:e.blake2bFinal,blake2s:t.blake2s,blake2sHex:t.blake2sHex,blake2sInit:t.blake2sInit,blake2sUpdate:t.blake2sUpdate,blake2sFinal:t.blake2sFinal},Y}var Ye=Ve(),je=xe(Ye);function Ee(e){if(e instanceof Uint8Array&&e.constructor.name==="Uint8Array")return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")}function Ge(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),o=0;o<r.length;o++)r[o]=255;for(var a=0;a<e.length;a++){var l=e.charAt(a),h=l.charCodeAt(0);if(r[h]!==255)throw new TypeError(l+" is ambiguous");r[h]=a}var u=e.length,f=e.charAt(0),d=Math.log(u)/Math.log(256),y=Math.log(256)/Math.log(u);function g(s){if(s instanceof Uint8Array||(ArrayBuffer.isView(s)?s=new Uint8Array(s.buffer,s.byteOffset,s.byteLength):Array.isArray(s)&&(s=Uint8Array.from(s))),!(s instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(s.length===0)return"";for(var m=0,c=0,i=0,b=s.length;i!==b&&s[i]===0;)i++,m++;for(var n=(b-i)*y+1>>>0,p=new Uint8Array(n);i!==b;){for(var v=s[i],E=0,A=n-1;(v!==0||E<c)&&A!==-1;A--,E++)v+=256*p[A]>>>0,p[A]=v%u>>>0,v=v/u>>>0;if(v!==0)throw new Error("Non-zero carry");c=E,i++}for(var k=n-c;k!==n&&p[k]===0;)k++;for(var M=f.repeat(m);k<n;++k)M+=e.charAt(p[k]);return M}function w(s){if(typeof s!="string")throw new TypeError("Expected String");if(s.length===0)return new Uint8Array;var m=0;if(s[m]!==" "){for(var c=0,i=0;s[m]===f;)c++,m++;for(var b=(s.length-m)*d+1>>>0,n=new Uint8Array(b);s[m];){var p=r[s.charCodeAt(m)];if(p===255)return;for(var v=0,E=b-1;(p!==0||v<i)&&E!==-1;E--,v++)p+=u*n[E]>>>0,n[E]=p%256>>>0,p=p/256>>>0;if(p!==0)throw new Error("Non-zero carry");i=v,m++}if(s[m]!==" "){for(var A=b-i;A!==b&&n[A]===0;)A++;for(var k=new Uint8Array(c+(b-A)),M=c;A!==b;)k[M++]=n[A++];return k}}}function x(s){var m=w(s);if(m)return m;throw new Error(`Non-${t} character`)}return{encode:g,decodeUnsafe:w,decode:x}}var Xe=Ge,We=Xe;class Ke{name;prefix;baseEncode;constructor(t,r,o){this.name=t,this.prefix=r,this.baseEncode=o}encode(t){if(t instanceof Uint8Array)return`${this.prefix}${this.baseEncode(t)}`;throw Error("Unknown type, must be binary type")}}class Qe{name;prefix;baseDecode;prefixCodePoint;constructor(t,r,o){this.name=t,this.prefix=r;const a=r.codePointAt(0);if(a===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=a,this.baseDecode=o}decode(t){if(typeof t=="string"){if(t.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(t)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(t.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(t){return Ae(this,t)}}class Je{decoders;constructor(t){this.decoders=t}or(t){return Ae(this,t)}decode(t){const r=t[0],o=this.decoders[r];if(o!=null)return o.decode(t);throw RangeError(`Unable to decode multibase string ${JSON.stringify(t)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}function Ae(e,t){return new Je({...e.decoders??{[e.prefix]:e},...t.decoders??{[t.prefix]:t}})}class Ze{name;prefix;baseEncode;baseDecode;encoder;decoder;constructor(t,r,o,a){this.name=t,this.prefix=r,this.baseEncode=o,this.baseDecode=a,this.encoder=new Ke(t,r,o),this.decoder=new Qe(t,r,a)}encode(t){return this.encoder.encode(t)}decode(t){return this.decoder.decode(t)}}function ke({name:e,prefix:t,encode:r,decode:o}){return new Ze(e,t,r,o)}function D({name:e,prefix:t,alphabet:r}){const{encode:o,decode:a}=We(r,e);return ke({prefix:t,name:e,encode:o,decode:l=>Ee(a(l))})}function et(e,t,r,o){let a=e.length;for(;e[a-1]==="=";)--a;const l=new Uint8Array(a*r/8|0);let h=0,u=0,f=0;for(let d=0;d<a;++d){const y=t[e[d]];if(y===void 0)throw new SyntaxError(`Non-${o} character`);u=u<<r|y,h+=r,h>=8&&(h-=8,l[f++]=255&u>>h)}if(h>=r||(255&u<<8-h)!==0)throw new SyntaxError("Unexpected end of data");return l}function tt(e,t,r){const o=t[t.length-1]==="=",a=(1<<r)-1;let l="",h=0,u=0;for(let f=0;f<e.length;++f)for(u=u<<8|e[f],h+=8;h>r;)h-=r,l+=t[a&u>>h];if(h!==0&&(l+=t[a&u<<r-h]),o)for(;(l.length*r&7)!==0;)l+="=";return l}function rt(e){const t={};for(let r=0;r<e.length;++r)t[e[r]]=r;return t}function I({name:e,prefix:t,bitsPerChar:r,alphabet:o}){const a=rt(o);return ke({prefix:t,name:e,encode(l){return tt(l,o,r)},decode(l){return et(l,a,r,e)}})}I({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});I({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5});I({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5});I({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5});I({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5});I({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5});I({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5});I({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5});I({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});D({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"});D({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});D({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});D({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var nt=Se,le=128,st=-128,it=Math.pow(2,31);function Se(e,t,r){t=t||[],r=r||0;for(var o=r;e>=it;)t[r++]=e&255|le,e/=128;for(;e&st;)t[r++]=e&255|le,e>>>=7;return t[r]=e|0,Se.bytes=r-o+1,t}var ot=K,at=128,ce=127;function K(e,o){var r=0,o=o||0,a=0,l=o,h,u=e.length;do{if(l>=u)throw K.bytes=0,new RangeError("Could not decode varint");h=e[l++],r+=a<28?(h&ce)<<a:(h&ce)*Math.pow(2,a),a+=7}while(h>=at);return K.bytes=l-o,r}var lt=Math.pow(2,7),ct=Math.pow(2,14),ut=Math.pow(2,21),ft=Math.pow(2,28),ht=Math.pow(2,35),dt=Math.pow(2,42),mt=Math.pow(2,49),yt=Math.pow(2,56),bt=Math.pow(2,63),gt=function(e){return e<lt?1:e<ct?2:e<ut?3:e<ft?4:e<ht?5:e<dt?6:e<mt?7:e<yt?8:e<bt?9:10},pt={encode:nt,decode:ot,encodingLength:gt},Ce=pt;function ue(e,t,r=0){return Ce.encode(e,t,r),t}function fe(e){return Ce.encodingLength(e)}function he(e,t){const r=t.byteLength,o=fe(e),a=o+fe(r),l=new Uint8Array(a+r);return ue(e,l,0),ue(r,l,o),l.set(t,a),new wt(e,r,t,l)}class wt{code;size;digest;bytes;constructor(t,r,o,a){this.code=t,this.size=r,this.digest=o,this.bytes=a}}function xt({name:e,code:t,encode:r}){return new vt(e,t,r)}class vt{name;code;encode;constructor(t,r,o){this.name=t,this.code=r,this.encode=o}digest(t){if(t instanceof Uint8Array){const r=this.encode(t);return r instanceof Uint8Array?he(this.code,r):r.then(o=>he(this.code,o))}else throw Error("Unknown type, must be binary type")}}const{blake2b:Et}=je,Z=xt({name:"blake2b-256",code:45600,encode:e=>Ee(Et(e,void 0,32))});/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function At(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name==="Uint8Array"}function kt(e,...t){if(!At(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error("Uint8Array expected of length "+t+", got length="+e.length)}const St=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",Ct=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function ee(e){if(kt(e),St)return e.toHex();let t="";for(let r=0;r<e.length;r++)t+=Ct[e[r]];return t}/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Ie=Symbol("Comlink.proxy"),It=Symbol("Comlink.endpoint"),Mt=Symbol("Comlink.releaseProxy"),j=Symbol("Comlink.finalizer"),_=Symbol("Comlink.thrown"),Me=e=>typeof e=="object"&&e!==null||typeof e=="function",Tt={canHandle:e=>Me(e)&&e[Ie],serialize(e){const{port1:t,port2:r}=new MessageChannel;return te(e,t),[r,[r]]},deserialize(e){return e.start(),Ot(e)}},Ut={canHandle:e=>Me(e)&&_ in e,serialize({value:e}){let t;return e instanceof Error?t={isError:!0,value:{message:e.message,name:e.name,stack:e.stack}}:t={isError:!1,value:e},[t,[]]},deserialize(e){throw e.isError?Object.assign(new Error(e.value.message),e.value):e.value}},Te=new Map([["proxy",Tt],["throw",Ut]]);function Pt(e,t){for(const r of e)if(t===r||r==="*"||r instanceof RegExp&&r.test(t))return!0;return!1}function te(e,t=globalThis,r=["*"]){t.addEventListener("message",function o(a){if(!a||!a.data)return;if(!Pt(r,a.origin)){console.warn(`Invalid origin '${a.origin}' for comlink proxy`);return}const{id:l,type:h,path:u}=Object.assign({path:[]},a.data),f=(a.data.argumentList||[]).map(T);let d;try{const y=u.slice(0,-1).reduce((w,x)=>w[x],e),g=u.reduce((w,x)=>w[x],e);switch(h){case"GET":d=g;break;case"SET":y[u.slice(-1)[0]]=T(a.data.value),d=!0;break;case"APPLY":d=g.apply(y,f);break;case"CONSTRUCT":{const w=new g(...f);d=Oe(w)}break;case"ENDPOINT":{const{port1:w,port2:x}=new MessageChannel;te(e,x),d=zt(w,[w])}break;case"RELEASE":d=void 0;break;default:return}}catch(y){d={value:y,[_]:0}}Promise.resolve(d).catch(y=>({value:y,[_]:0})).then(y=>{const[g,w]=F(y);t.postMessage(Object.assign(Object.assign({},g),{id:l}),w),h==="RELEASE"&&(t.removeEventListener("message",o),Ue(t),j in e&&typeof e[j]=="function"&&e[j]())}).catch(y=>{const[g,w]=F({value:new TypeError("Unserializable return value"),[_]:0});t.postMessage(Object.assign(Object.assign({},g),{id:l}),w)})}),t.start&&t.start()}function Bt(e){return e.constructor.name==="MessagePort"}function Ue(e){Bt(e)&&e.close()}function Ot(e,t){const r=new Map;return e.addEventListener("message",function(a){const{data:l}=a;if(!l||!l.id)return;const h=r.get(l.id);if(h)try{h(l)}finally{r.delete(l.id)}}),Q(e,r,[],t)}function R(e){if(e)throw new Error("Proxy has been released and is not useable")}function Pe(e){return P(e,new Map,{type:"RELEASE"}).then(()=>{Ue(e)})}const z=new WeakMap,$="FinalizationRegistry"in globalThis&&new FinalizationRegistry(e=>{const t=(z.get(e)||0)-1;z.set(e,t),t===0&&Pe(e)});function Rt(e,t){const r=(z.get(t)||0)+1;z.set(t,r),$&&$.register(e,t,e)}function _t(e){$&&$.unregister(e)}function Q(e,t,r=[],o=function(){}){let a=!1;const l=new Proxy(o,{get(h,u){if(R(a),u===Mt)return()=>{_t(l),Pe(e),t.clear(),a=!0};if(u==="then"){if(r.length===0)return{then:()=>l};const f=P(e,t,{type:"GET",path:r.map(d=>d.toString())}).then(T);return f.then.bind(f)}return Q(e,t,[...r,u])},set(h,u,f){R(a);const[d,y]=F(f);return P(e,t,{type:"SET",path:[...r,u].map(g=>g.toString()),value:d},y).then(T)},apply(h,u,f){R(a);const d=r[r.length-1];if(d===It)return P(e,t,{type:"ENDPOINT"}).then(T);if(d==="bind")return Q(e,t,r.slice(0,-1));const[y,g]=de(f);return P(e,t,{type:"APPLY",path:r.map(w=>w.toString()),argumentList:y},g).then(T)},construct(h,u){R(a);const[f,d]=de(u);return P(e,t,{type:"CONSTRUCT",path:r.map(y=>y.toString()),argumentList:f},d).then(T)}});return Rt(l,e),l}function Nt(e){return Array.prototype.concat.apply([],e)}function de(e){const t=e.map(F);return[t.map(r=>r[0]),Nt(t.map(r=>r[1]))]}const Be=new WeakMap;function zt(e,t){return Be.set(e,t),e}function Oe(e){return Object.assign(e,{[Ie]:!0})}function F(e){for(const[t,r]of Te)if(r.canHandle(e)){const[o,a]=r.serialize(e);return[{type:"HANDLER",name:t,value:o},a]}return[{type:"RAW",value:e},Be.get(e)||[]]}function T(e){switch(e.type){case"HANDLER":return Te.get(e.name).deserialize(e.value);case"RAW":return e.value}}function P(e,t,r,o){return new Promise(a=>{const l=$t();t.set(l,a),e.start&&e.start(),e.postMessage(Object.assign({id:l},r),o)})}function $t(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}var Ft={rules:{colorCount:{maxColors:3,tolerance:10,whiteTolerance:10,frequencyThreshold:.01},colorIslands:{minIslandSize:50,warningThreshold:50,errorThreshold:100,colorTolerance:50},colorContrast:{maxContrastDelta:100,minContrastLength:3,samplingSteps:2},imageHash:{warningThreshold:10,errorThreshold:20}},preprocessors:{colorMerge:{tolerance:25}}},Dt={name:"color-islands",description:"Checks if there are color islands smaller than the minimum size",type:"single",check:async e=>{try{let t=Ft.rules.colorIslands,r=new Uint8ClampedArray(e),o=r.length/4,a=Math.sqrt(o),l=a;if(!Number.isInteger(a)||!Number.isInteger(l))return{status:"error",metadata:[{message:"Could not determine image dimensions. Invalid image data format."}],type:"colorIslands"};let h=4,u=new Set,f=[],d=(s,m,c)=>{for(let i=0;i<3;i++)if(Math.abs(s[i]-m[i])>c)return!1;return!0},y=(s,m)=>{let c=[s],i={color:m,size:0,bounds:{minX:s.x,minY:s.y,maxX:s.x,maxY:s.y}},b=(n,p)=>{let v=(p*a+n)*h,E=[r[v],r[v+1],r[v+2]];return d(m,E,t.colorTolerance)};for(;c.length>0;){let{x:n,y:p}=c.shift(),v=`${n},${p}`;if(u.has(v)||(u.add(v),!b(n,p)))continue;i.size++,i.bounds.minX=Math.min(i.bounds.minX,n),i.bounds.minY=Math.min(i.bounds.minY,p),i.bounds.maxX=Math.max(i.bounds.maxX,n),i.bounds.maxY=Math.max(i.bounds.maxY,p);let E=[{x:n+1,y:p},{x:n-1,y:p},{x:n,y:p+1},{x:n,y:p-1}];for(let A of E)A.x>=0&&A.x<a&&A.y>=0&&A.y<l&&!u.has(`${A.x},${A.y}`)&&c.push(A)}return i};for(let s=0;s<l;s++)for(let m=0;m<a;m++){let c=`${m},${s}`;if(u.has(c))continue;let i=(s*a+m)*h,b=[r[i],r[i+1],r[i+2]],n=y({x:m,y:s},b);n.size<t.minIslandSize&&f.push(n)}if(f.length===0)return{status:"pass",metadata:[{message:"No small color islands found"}],type:"colorIslands"};let g=f.filter(s=>s.size<t.errorThreshold),w=g.length>0?"error":"warn",x=g.map(s=>{let m={x:s.bounds.minX,y:s.bounds.minY,width:s.bounds.maxX-s.bounds.minX+1,height:s.bounds.maxY-s.bounds.minY+1},c=(m.x/a*100).toFixed(1),i=(m.y/l*100).toFixed(1),b=(m.width/a*100).toFixed(1),n=(m.height/l*100).toFixed(1);return{message:`Found failing color island:
  - Size: ${s.size} pixels (below error threshold: ${t.errorThreshold})
  - Position: (${m.x}, ${m.y}) [${c}%, ${i}% of image]
  - Dimensions: ${m.width}x${m.height} pixels [${b}%x${n}% of image]
  - Bounding box: (${m.x},${m.y}) to (${s.bounds.maxX},${s.bounds.maxY})`,location:m}});return g.length===0&&f.length>0&&x.push({message:`Found ${f.length} small color islands above error threshold`}),{status:w,metadata:x,type:"colorIslands"}}catch(t){return{status:"error",metadata:[{message:`Failed to analyze color islands: ${t instanceof Error?t.message:"Unknown error"}`}],type:"colorIslands"}}}},G={exports:{}},me;function Ht(){return me||(me=1,(function(e){var t=Object.prototype.hasOwnProperty,r="~";function o(){}Object.create&&(o.prototype=Object.create(null),new o().__proto__||(r=!1));function a(f,d,y){this.fn=f,this.context=d,this.once=y||!1}function l(f,d,y,g,w){if(typeof y!="function")throw new TypeError("The listener must be a function");var x=new a(y,g||f,w),s=r?r+d:d;return f._events[s]?f._events[s].fn?f._events[s]=[f._events[s],x]:f._events[s].push(x):(f._events[s]=x,f._eventsCount++),f}function h(f,d){--f._eventsCount===0?f._events=new o:delete f._events[d]}function u(){this._events=new o,this._eventsCount=0}u.prototype.eventNames=function(){var d=[],y,g;if(this._eventsCount===0)return d;for(g in y=this._events)t.call(y,g)&&d.push(r?g.slice(1):g);return Object.getOwnPropertySymbols?d.concat(Object.getOwnPropertySymbols(y)):d},u.prototype.listeners=function(d){var y=r?r+d:d,g=this._events[y];if(!g)return[];if(g.fn)return[g.fn];for(var w=0,x=g.length,s=new Array(x);w<x;w++)s[w]=g[w].fn;return s},u.prototype.listenerCount=function(d){var y=r?r+d:d,g=this._events[y];return g?g.fn?1:g.length:0},u.prototype.emit=function(d,y,g,w,x,s){var m=r?r+d:d;if(!this._events[m])return!1;var c=this._events[m],i=arguments.length,b,n;if(c.fn){switch(c.once&&this.removeListener(d,c.fn,void 0,!0),i){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,y),!0;case 3:return c.fn.call(c.context,y,g),!0;case 4:return c.fn.call(c.context,y,g,w),!0;case 5:return c.fn.call(c.context,y,g,w,x),!0;case 6:return c.fn.call(c.context,y,g,w,x,s),!0}for(n=1,b=new Array(i-1);n<i;n++)b[n-1]=arguments[n];c.fn.apply(c.context,b)}else{var p=c.length,v;for(n=0;n<p;n++)switch(c[n].once&&this.removeListener(d,c[n].fn,void 0,!0),i){case 1:c[n].fn.call(c[n].context);break;case 2:c[n].fn.call(c[n].context,y);break;case 3:c[n].fn.call(c[n].context,y,g);break;case 4:c[n].fn.call(c[n].context,y,g,w);break;default:if(!b)for(v=1,b=new Array(i-1);v<i;v++)b[v-1]=arguments[v];c[n].fn.apply(c[n].context,b)}}return!0},u.prototype.on=function(d,y,g){return l(this,d,y,g,!1)},u.prototype.once=function(d,y,g){return l(this,d,y,g,!0)},u.prototype.removeListener=function(d,y,g,w){var x=r?r+d:d;if(!this._events[x])return this;if(!y)return h(this,x),this;var s=this._events[x];if(s.fn)s.fn===y&&(!w||s.once)&&(!g||s.context===g)&&h(this,x);else{for(var m=0,c=[],i=s.length;m<i;m++)(s[m].fn!==y||w&&!s[m].once||g&&s[m].context!==g)&&c.push(s[m]);c.length?this._events[x]=c.length===1?c[0]:c:h(this,x)}return this},u.prototype.removeAllListeners=function(d){var y;return d?(y=r?r+d:d,this._events[y]&&h(this,y)):(this._events=new o,this._eventsCount=0),this},u.prototype.off=u.prototype.removeListener,u.prototype.addListener=u.prototype.on,u.prefixed=r,u.EventEmitter=u,e.exports=u})(G)),G.exports}var qt=Ht(),Lt=xe(qt);class Re extends Error{constructor(t){super(t),this.name="TimeoutError"}}class Vt extends Error{constructor(t){super(),this.name="AbortError",this.message=t}}const ye=e=>globalThis.DOMException===void 0?new Vt(e):new DOMException(e),be=e=>{const t=e.reason===void 0?ye("This operation was aborted."):e.reason;return t instanceof Error?t:ye(t)};function Yt(e,t){const{milliseconds:r,fallback:o,message:a,customTimers:l={setTimeout,clearTimeout}}=t;let h,u;const d=new Promise((y,g)=>{if(typeof r!="number"||Math.sign(r)!==1)throw new TypeError(`Expected \`milliseconds\` to be a positive number, got \`${r}\``);if(t.signal){const{signal:x}=t;x.aborted&&g(be(x)),u=()=>{g(be(x))},x.addEventListener("abort",u,{once:!0})}if(r===Number.POSITIVE_INFINITY){e.then(y,g);return}const w=new Re;h=l.setTimeout.call(void 0,()=>{if(o){try{y(o())}catch(x){g(x)}return}typeof e.cancel=="function"&&e.cancel(),a===!1?y():a instanceof Error?g(a):(w.message=a??`Promise timed out after ${r} milliseconds`,g(w))},r),(async()=>{try{y(await e)}catch(x){g(x)}})()}).finally(()=>{d.clear(),u&&t.signal&&t.signal.removeEventListener("abort",u)});return d.clear=()=>{l.clearTimeout.call(void 0,h),h=void 0},d}function jt(e,t,r){let o=0,a=e.length;for(;a>0;){const l=Math.trunc(a/2);let h=o+l;r(e[h],t)<=0?(o=++h,a-=l+1):a=l}return o}class Gt{#e=[];enqueue(t,r){r={priority:0,...r};const o={priority:r.priority,id:r.id,run:t};if(this.size===0||this.#e[this.size-1].priority>=r.priority){this.#e.push(o);return}const a=jt(this.#e,o,(l,h)=>h.priority-l.priority);this.#e.splice(a,0,o)}setPriority(t,r){const o=this.#e.findIndex(l=>l.id===t);if(o===-1)throw new ReferenceError(`No promise function with the id "${t}" exists in the queue.`);const[a]=this.#e.splice(o,1);this.enqueue(a.run,{priority:r,id:t})}dequeue(){return this.#e.shift()?.run}filter(t){return this.#e.filter(r=>r.priority===t.priority).map(r=>r.run)}get size(){return this.#e.length}}class Xt extends Lt{#e;#o;#i=0;#d;#a;#m=0;#r;#l;#t;#y;#n=0;#c;#s;#b;#w=1n;timeout;constructor(t){if(super(),t={carryoverConcurrencyCount:!1,intervalCap:Number.POSITIVE_INFINITY,interval:0,concurrency:Number.POSITIVE_INFINITY,autoStart:!0,queueClass:Gt,...t},!(typeof t.intervalCap=="number"&&t.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${t.intervalCap?.toString()??""}\` (${typeof t.intervalCap})`);if(t.interval===void 0||!(Number.isFinite(t.interval)&&t.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${t.interval?.toString()??""}\` (${typeof t.interval})`);this.#e=t.carryoverConcurrencyCount,this.#o=t.intervalCap===Number.POSITIVE_INFINITY||t.interval===0,this.#d=t.intervalCap,this.#a=t.interval,this.#t=new t.queueClass,this.#y=t.queueClass,this.concurrency=t.concurrency,this.timeout=t.timeout,this.#b=t.throwOnTimeout===!0,this.#s=t.autoStart===!1}get#x(){return this.#o||this.#i<this.#d}get#v(){return this.#n<this.#c}#E(){this.#n--,this.#u(),this.emit("next")}#A(){this.#p(),this.#g(),this.#l=void 0}get#k(){const t=Date.now();if(this.#r===void 0){const r=this.#m-t;if(r<0)this.#i=this.#e?this.#n:0;else return this.#l===void 0&&(this.#l=setTimeout(()=>{this.#A()},r)),!0}return!1}#u(){if(this.#t.size===0)return this.#r&&clearInterval(this.#r),this.#r=void 0,this.emit("empty"),this.#n===0&&this.emit("idle"),!1;if(!this.#s){const t=!this.#k;if(this.#x&&this.#v){const r=this.#t.dequeue();return r?(this.emit("active"),r(),t&&this.#g(),!0):!1}}return!1}#g(){this.#o||this.#r!==void 0||(this.#r=setInterval(()=>{this.#p()},this.#a),this.#m=Date.now()+this.#a)}#p(){this.#i===0&&this.#n===0&&this.#r&&(clearInterval(this.#r),this.#r=void 0),this.#i=this.#e?this.#n:0,this.#f()}#f(){for(;this.#u(););}get concurrency(){return this.#c}set concurrency(t){if(!(typeof t=="number"&&t>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${t}\` (${typeof t})`);this.#c=t,this.#f()}async#S(t){return new Promise((r,o)=>{t.addEventListener("abort",()=>{o(t.reason)},{once:!0})})}setPriority(t,r){this.#t.setPriority(t,r)}async add(t,r={}){return r.id??=(this.#w++).toString(),r={timeout:this.timeout,throwOnTimeout:this.#b,...r},new Promise((o,a)=>{this.#t.enqueue(async()=>{this.#n++,this.#i++;try{r.signal?.throwIfAborted();let l=t({signal:r.signal});r.timeout&&(l=Yt(Promise.resolve(l),{milliseconds:r.timeout})),r.signal&&(l=Promise.race([l,this.#S(r.signal)]));const h=await l;o(h),this.emit("completed",h)}catch(l){if(l instanceof Re&&!r.throwOnTimeout){o();return}a(l),this.emit("error",l)}finally{this.#E()}},r),this.emit("add"),this.#u()})}async addAll(t,r){return Promise.all(t.map(async o=>this.add(o,r)))}start(){return this.#s?(this.#s=!1,this.#f(),this):this}pause(){this.#s=!0}clear(){this.#t=new this.#y}async onEmpty(){this.#t.size!==0&&await this.#h("empty")}async onSizeLessThan(t){this.#t.size<t||await this.#h("next",()=>this.#t.size<t)}async onIdle(){this.#n===0&&this.#t.size===0||await this.#h("idle")}async#h(t,r){return new Promise(o=>{const a=()=>{r&&!r()||(this.off(t,a),o())};this.on(t,a)})}get size(){return this.#t.size}sizeBy(t){return this.#t.filter(t).length}get pending(){return this.#n}get isPaused(){return this.#s}}var X=Jt(1,2,3,4);function _e(e){return{Procedural:W(4,X),ProceduralPersonal:[0,0,0,0,0,0,0,...W(1,X)],ProceduralAccount:W(32,X)}[e]}function ge(e){return Array.from(e).join(",")}function Wt(e,t=16){const r=_e(e);return Qt(r,{size:t})}function Kt(e,t={minBits:1,maxBits:3}){if(t.minBits>t.maxBits)throw new Error("minBits must be less than maxBits");if(t.minBits<1)throw new Error("minBits must be greater than 0");if(t.maxBits<1)throw new Error("maxBits must be greater than 0");const r=Array.from(e);if(e.length===8){const l=r.slice(-4);pe(Math.max(Math.floor(Math.random()*t.maxBits),t.minBits))(l),r.splice(-4,4,...l)}else pe(Math.floor(Math.random()*3)+1)(r);return r}function Qt(e,t){const r=new Map;for(r.set(ge(e),Array.from(e));r.size<t.size;){const o=Kt(e),a=ge(o);r.has(a)||r.set(a,o)}return[...r.values()]}function W(e,t){const r=Array(e).fill(0);for(let o=0;o<e;o++)r[o]=Math.floor(t()*255);return r}function Jt(e,t,r,o){return function(){e|=0,t|=0,r|=0,o|=0;const a=(e+t|0)+o|0;return o=o+1|0,e=t^t>>>9,t=r+(r<<3)|0,r=r<<21|r>>>11,r=r+a|0,(a>>>0)/4294967296}}function pe(e){return t=>{for(let r=0;r<e;++r){const o=2**Math.floor(Math.random()*8),a=Math.floor(Math.random()*4);t[a]^=o}}}var Zt=`
  const black = "#000000"
  const white = "#fff"
  const light = "#aaa"
  const dark = "#666"

  function getByte(seed, index) {
  return seed[index % seed.length];
}
  function split(seed, parts) {
  const r = [];
  let last = 0;
  for (let i = 0;i < parts; ++i) {
    const next = Math.round((i + 1) * 32 / parts);
    r.push(bits(seed, last, next));
    last = next;
  }
  return r;
}
  function bytesToNibbles(bytes) {
  const nibbles = new Array(bytes.length * 2);
  for (let i = 0;i < bytes.length; i++) {
    const byte = getByte(bytes, i);
    nibbles[i * 2] = byte >> 4 & 15;
    nibbles[i * 2 + 1] = byte & 15;
  }
  return nibbles;
}
  function bit(seed, i) {
  return getByte(seed, Math.floor(i / 8)) >> i % 8 & 1;
}
  function bits(seed, from = 0, to = 32) {
  let r = 0;
  for (let i = from;i < to; ++i)
    r = (r << 1 | bit(seed, i)) >>> 0;
  return r;
}
  function symmetrical(factor, fn, ctx) {
  ctx.translate(50, 50);
  ctx.scale(50, 50);
  for (let i = 0;i < factor; ++i) {
    ctx.save();
    ctx.rotate(Math.PI * 2 * i / factor);
    fn(i);
    ctx.restore();
  }
}
  function strokeEach(array, fn, ctx) {
  array.forEach((element, index) => {
    ctx.beginPath();
    fn(element, index);
    ctx.stroke();
  });
}
  function fillEach(array, fn, ctx) {
  array.forEach((element, index) => {
    ctx.beginPath();
    fn(element, index);
    ctx.fill();
  });
}
  function numeric(seed) {
  if (seed.length > 64)
    throw "Seed too long to safely convert to a bigint";
  let result = 0n;
  for (let i = 0;i < seed.length; i++)
    result = result << 8n | BigInt(getByte(seed, i));
  return result;
}
  function randomGenerator(seed) {
  let a = bits(seed), b = bits(seed), c = bits(seed), d = bits(seed);
  return () => {
    const t = a + b | 0;
    a = b ^ b >>> 9;
    b = c + (c << 3) | 0;
    c = c << 21 | c >>> 11;
    d = d + 1 | 0;
    return ((t + d | 0) >>> 0) / 4294967296;
  };
}
  function sfc32(a, b, c, d) {
  return () => {
    a |= 0;
    b |= 0;
    c |= 0;
    d |= 0;
    const t = (a + b | 0) + d | 0;
    d = d + 1 | 0;
    a = b ^ b >>> 9;
    b = c + (c << 3) | 0;
    c = c << 21 | c >>> 11;
    c = c + t | 0;
    return (t >>> 0) / 4294967296;
  };
}
  function bytesToBits(bytes) {
  const bits = new Array(bytes.length * 8);
  for (let i = 0;i < bytes.length; i++) {
    const byte = getByte(bytes, i);
    bits[i * 8] = byte >> 7 & 1;
    bits[i * 8 + 1] = byte >> 6 & 1;
    bits[i * 8 + 2] = byte >> 5 & 1;
    bits[i * 8 + 3] = byte >> 4 & 1;
    bits[i * 8 + 4] = byte >> 3 & 1;
    bits[i * 8 + 5] = byte >> 2 & 1;
    bits[i * 8 + 6] = byte >> 1 & 1;
    bits[i * 8 + 7] = byte & 1;
  }
  return bits;
}
  function bytesToQuarterBytes(bytes) {
  const quarterBytes = new Array(bytes.length * 4);
  for (let i = 0;i < bytes.length; i++) {
    const byte = getByte(bytes, i);
    quarterBytes[i * 4] = byte >> 6 & 3;
    quarterBytes[i * 4 + 1] = byte >> 4 & 3;
    quarterBytes[i * 4 + 2] = byte >> 2 & 3;
    quarterBytes[i * 4 + 3] = byte & 3;
  }
  return quarterBytes;
}
  function map(value, inputStart, inputStop, outputStart, outputStop, withinBounds = !0) {
  const result = outputStart + (outputStop - outputStart) * ((value - inputStart) / (inputStop - inputStart));
  if (!withinBounds)
    return result;
  const minOutput = Math.min(outputStart, outputStop), maxOutput = Math.max(outputStart, outputStop);
  return Math.max(minOutput, Math.min(maxOutput, result));
}
`,Ne=class{constructor(e=300){this.timeoutMs=e,this.queue=new Xt({concurrency:4})}algorithms=new Map;metadata=new Map;queue;updateAlgorithm(e,t,r){this.algorithms.set(e,t),this.metadata.set(e,r)}async testRender(e){if(!this.algorithms.get(e))throw new Error(`No script found for algorithm ${e}`);const r=this.metadata.get(e);if(!r)throw new Error(`No kind found for algorithm ${e}`);const o=_e(r);await this.render(e,50,o)}async render(e,t,r,o={output:"bitmap"}){const a=this.algorithms.get(e);if(!a)throw new Error(`No script found for algorithm ${e}`);return this.queue.add(()=>this.drawWithTimeout(a,t,[...r],o.output))}async renderBitmap(e,t,r){return this.render(e,t,r,{output:"bitmap"})}async renderImageData(e,t,r){return this.render(e,t,r,{output:"imagedata"})}async hash(e,t,r){const o=await this.renderImageData(e,t,r),a=new ArrayBuffer(o.data.length);new Uint8Array(a).set(o.data);const l=await Z.digest(new Uint8Array(a));return ee(l.digest)}cancelPending(){this.queue.clear()}getAlgorithmMeta(e){const t=this.metadata.get(e);if(t)return{kind:t}}getAlgorithm(e){return this.algorithms.get(e)}async drawWithTimeout(e,t,r,o){const a=new OffscreenCanvas(t,t),l=a.getContext("2d");if(!l)throw new Error("Failed to get 2D rendering context");const h=new Promise((f,d)=>setTimeout(()=>d(new Error(`Render timed out after ${this.timeoutMs}ms`)),this.timeoutMs)),u=(async()=>{try{l.scale(a.width/100,a.width/100),l.lineWidth=1,l.lineCap="butt",l.lineJoin="miter",l.strokeStyle="black",l.fillStyle="black",l.textAlign="center",l.textBaseline="bottom";let f;try{f=new Function("ctx","seed",`${Zt}
${e}`)}catch(d){throw d instanceof SyntaxError?new Error(`Syntax error: ${d.message}`):new Error(`Syntax error: ${d}`)}try{f(l,[...r])}catch(d){throw new Error(`Runtime error: ${d}`)}return o==="imagedata"?l.getImageData(0,0,t,t):a.transferToImageBitmap()}catch(f){throw f}})();return await Promise.race([u,h])}},er=300,tr=250,rr=class{renderCore;rules=[];constructor(e=300){this.renderCore=new Ne(e)}addRule(e){this.rules.push(e)}setRules(e){this.rules=e}async benchmark(e){const{algorithmId:t,algorithm:r,kind:o,size:a=er,amount:l=tr,onProgress:h}=e,u=this.rules.filter(n=>n.type==="code"),f=this.rules.filter(n=>n.type!=="code"),d=[];for(const n of u){const p=await n.check(r);if(d.push({ruleName:n.name,ruleType:"code",status:p.status,metadata:p.metadata}),p.status==="error")return{version:1,amount:l,algorithmId:t,size:a,failedTotal:l,collisionsTotal:0,errors:l,warningDistribution:{},ruleResults:d,errorMessage:p.metadata?.[0]?.message||"Code rule violation"}}this.renderCore.updateAlgorithm(t,r,o);const y=Wt(o,l),g=[],w={},x=new Set;let s=0,m=0;for(const n of y){try{const{compliance:p,ruleResults:v}=await this.checkCompliance(t,n,a,f);g.push(p),s===0&&d.push(...v);const E=w[p.imageHash];E?w[p.imageHash]=[...E,[...n]]:w[p.imageHash]=[[...n]],x.has(p.imageHash)||x.add(p.imageHash)}catch{m++}s++,s%5===0&&h&&h(s/l)}h&&h(1);const c=g.filter(n=>!n.isCompliant).length,i={};for(const n of g){const p=n.issues.length;i[p]?i[p]++:i[p]=1}const b=Object.entries(w).filter(([,n])=>n.length>1);if(b.length>0){console.log(`
ðŸ” Found ${b.length} collision(s):`);for(const[n,p]of b){console.log(`  Hash: ${n.substring(0,16)}...`),console.log("  Seeds producing same hash:");for(const v of p)console.log(`    [${v.slice(0,8).join(", ")}...]`)}}return{version:1,warningDistribution:i,failedTotal:c,collisionsTotal:b.length,size:a,amount:l,errors:m,algorithmId:t,ruleResults:d,errorMessage:m===l?"All iterations failed":void 0}}async checkCompliance(e,t,r,o){const a=await this.renderCore.renderImageData(e,r,t),l=new ArrayBuffer(a.data.length);new Uint8Array(l).set(a.data);const h=await Z.digest(new Uint8Array(l)),u=ee(h.digest),f=await Promise.all(o.map(x=>x.type==="single"?x.check(l):null)),d=[];let y=!0;const g=new Set,w=[];for(let x=0;x<o.length;x++){const s=o[x],m=f[x];m&&(w.push({ruleName:s.name,ruleType:s.type,status:m.status,metadata:m.metadata}),m.status!=="pass"&&m.metadata&&(d.push(...m.metadata),y=!1,g.add(s.type)))}return{compliance:{isCompliant:y,imageHash:u,issues:d,ruleTypesFailed:Array.from(g)},ruleResults:w}}};const ze=300,N=300,nr=300,sr=1e3,$e=[Dt],B=new Ne(ze),U=[];let O=!1,we;const ir={async updateAlgorithm(e,t,r="Procedural"){B.updateAlgorithm(e,t,r)},async checkCompliance(e,t,r={referenceSize:N,overlaySize:N,withOverlay:!1}){return new Promise((o,a)=>{const l=[...t],h={algorithmId:e,overlaySize:r.overlaySize,referenceSize:r.referenceSize??N,withOverlay:r.withOverlay??!1,seed:l,resolve:o,reject:a};U.push(h),J()})},onProgress:Oe(e=>{we=e}),async benchmark(e,t=nr,r=sr){const o=B.getAlgorithmMeta(e);if(!o)throw new Error(`No algorithm meta found for algorithm ${e}`);const a=B.getAlgorithm(e);if(!a)throw new Error(`No algorithm found for algorithm ${e}`);const l=new rr(ze);return l.setRules($e),await l.benchmark({algorithmId:e,algorithm:a,kind:o.kind,size:t,amount:r,onProgress:u=>{we?.(u)}})},cancelCheck(e,t,r){const o=U.findIndex(a=>a.algorithmId===e&&a.overlaySize===t&&ar(a.seed,r));o!==-1&&(U[o].reject(new Error("Compliance check cancelled")),U.splice(o,1))},cancelAllChecks(){B.cancelPending(),U.length=0,O=!1}};async function J(){if(O||U.length===0)return;O=!0;const{algorithmId:e,referenceSize:t,overlaySize:r,withOverlay:o,seed:a,resolve:l,reject:h}=U.shift();try{const u=await B.renderImageData(e,t,a),f=new ArrayBuffer(u.data.length);new Uint8Array(f).set(u.data);const d=await Z.digest(new Uint8Array(f)),y=ee(d.digest),g=await or(f),w=[];let x=!0;const s=new Set;for(const i of g)i.status!=="pass"&&i.metadata&&(w.push(...i.metadata),x=!1,i.type&&s.add(i.type));let m;if(o){if(!r){h(new Error("Overlay size is required")),O=!1,J();return}if(!x&&w.length>0&&w.some(i=>i.location)){const i=new OffscreenCanvas(r,r),b=i.getContext("2d");if(b){b.fillStyle="rgba(0, 0, 0, 0)",b.fillRect(0,0,i.width,i.height),b.strokeStyle="rgba(255, 0, 0, 0.7)",b.lineWidth=4;const n=i.width/N,p=5;for(const v of w)if(v.location){const{x:E,y:A,width:k,height:M}=v.location,H=E*n,S=A*n,C=k*n,Fe=M*n,re=Math.max(0,H-p),ne=Math.max(0,S-p),De=Math.min(r-re,C+p*2),He=Math.min(r-ne,Fe+p*2);b.strokeRect(re,ne,De,He)}m=b.getImageData(0,0,r,r)}}}const c={isCompliant:x,imageHash:y,issues:w,issueOverlayImageData:m,ruleTypesFailed:Array.from(s)};l(c)}catch(u){console.error(u),h(u)}O=!1,J()}async function or(e){return Promise.all($e.map(t=>t.check(e)))}function ar(e,t){return e.length!==t.length?!1:e.every((r,o)=>r===t[o])}te(ir);
