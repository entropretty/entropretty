import{c as q,u as C,g as B,r as A,j as i,s as D,t as I,L as F,f as K,N as T}from"./main-D_QOtJ75.js";import{A as z}from"./AlgorithmInfo-4eJFaIHW.js";import{B as k}from"./button-BnWcWO71.js";import{u as R}from"./useMutation-DYqESHb7.js";import{j as $,L as Q,F as V}from"./index-B8xx3lLY.js";import{A as M,m as L}from"./proxy-zRc3mXX4.js";import{F as U}from"./FamilyKindBadge-rjTMkzGm.js";import{A as Y}from"./AlgorithmBitmap-CUFHLwpA.js";import{g as G,s as O}from"./index-BzRZEjlo.js";import{u as W}from"./useInfiniteQuery-it1EuC-d.js";import{u as X}from"./index-DFufhFO-.js";import"./utils-CjfV1Qjd.js";import"./label-CqcMyrRf.js";import"./index-CtIrN4Eb.js";import"./createLucideIcon-4ydf6LMZ.js";import"./useBaseQuery-BJjxcAKU.js";function Z(e){const t=q.c(31),{algorithm:r}=e,{user:a}=C(),d=B(),[s,m]=A.useState(!1),[o,f]=$(),p=a?.id===r.user_id;let u;t[0]!==r.id||t[1]!==p||t[2]!==a?(u=async()=>{if(!a||!p)throw new Error("Unauthorized");const{error:v}=await D.from("algorithms").delete().eq("id",r.id).eq("user_id",a.id);if(v)throw v;return r.id},t[0]=r.id,t[1]=p,t[2]=a,t[3]=u):u=t[3];let l;t[4]!==d?(l=()=>{d.invalidateQueries({queryKey:["algorithms"]}),I.success("Algorithm deleted successfully"),m(!1)},t[4]=d,t[5]=l):l=t[5];let y;t[6]===Symbol.for("react.memo_cache_sentinel")?(y=v=>{console.error("Error deleting algorithm:",v),I.error("Error Deleting Algorithm: "+v.message),m(!1)},t[6]=y):y=t[6];let h;t[7]!==u||t[8]!==l?(h={mutationFn:u,onSuccess:l,onError:y},t[7]=u,t[8]=l,t[9]=h):h=t[9];const n=R(h);let g,x;t[10]!==s?(g=()=>{let v;return s&&(v=setTimeout(()=>{m(!1)},3e3)),()=>{v&&clearTimeout(v)}},x=[s],t[10]=s,t[11]=g,t[12]=x):(g=t[11],x=t[12]),A.useEffect(g,x);let j;t[13]!==n||t[14]!==s?(j=()=>{s?n.mutate():m(!0)},t[13]=n,t[14]=s,t[15]=j):j=t[15];const c=j;if(!p)return null;let w;t[16]!==f.width?(w={width:f.width},t[16]=f.width,t[17]=w):w=t[17];let E;t[18]===Symbol.for("react.memo_cache_sentinel")?(E={duration:.1,type:"spring"},t[18]=E):E=t[18];const P=s?"destructive":"ghost";let _;t[19]!==n.isPending||t[20]!==s?(_=n.isPending?i.jsx(Q,{className:"h-4 w-4 animate-spin"}):i.jsx(M,{mode:"wait",children:i.jsx(L.div,{layout:!0,initial:{opacity:0,width:"100%"},animate:{opacity:1,width:"auto"},exit:{opacity:0,width:"100%"},transition:{duration:.2},children:s?"YES, DELETE!":"DELETE"},s?"confirm":"delete")}),t[19]=n.isPending,t[20]=s,t[21]=_):_=t[21];let b;t[22]!==n.isPending||t[23]!==c||t[24]!==o||t[25]!==P||t[26]!==_?(b=i.jsx(k,{variant:P,onMouseDown:c,ref:o,disabled:n.isPending,className:"gap-2 transition-colors",children:_}),t[22]=n.isPending,t[23]=c,t[24]=o,t[25]=P,t[26]=_,t[27]=b):b=t[27];let N;return t[28]!==b||t[29]!==w?(N=i.jsx(L.div,{className:"overflow-hidden",animate:w,transition:E,children:b}),t[28]=b,t[29]=w,t[30]=N):N=t[30],N}function H({algorithm:e}){const{user:t}=C(),r=A.useMemo(()=>[...G(e.family_kind)],[e.family_kind]);return e.id?i.jsxs("div",{className:"bg-background border-background-200 relative flex w-full items-center justify-between gap-4 border p-2",children:[i.jsx(U,{familyKind:e.family_kind,className:"absolute bottom-0 left-0 z-10"}),i.jsxs("div",{className:"relative flex items-center gap-4",children:[i.jsx("div",{children:i.jsx(Y,{algorithmId:e.id,seed:r,size:68,scale:2},O(r))}),i.jsx(z,{algorithm:e})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(k,{asChild:!0,variant:"link",children:i.jsx(F,{to:`/a/${e.id}`,children:"VIEW"})}),t&&i.jsx(k,{asChild:!0,variant:"link",children:i.jsx(F,{to:`/create?remix=${e.id}`,children:"REMIX"})}),i.jsx(Z,{algorithm:e})]})]}):null}const S=3;function J(e){const t=K();return W({queryKey:["algorithms","user-id",e],enabled:!!e,initialPageParam:0,queryFn:async({pageParam:r})=>{const a=r*S,d=a+S-1,{data:s,error:m}=await D.from("algorithms_with_user_profile").select().eq("user_id",e).order("created_at",{ascending:!1}).range(a,d);if(s)for(const o of s)t.addAlgorithm(o.id,o.content,o.family_kind);if(m)throw m;return s},getNextPageParam:(r,a)=>r.length===S?a.length:void 0})}function ee(){const e=q.c(26),{user:t}=C(),{ref:r,inView:a}=X(),{data:d,isLoading:s,fetchNextPage:m,hasNextPage:o,isFetchingNextPage:f}=J(t?.id);let p,u;if(e[0]!==m||e[1]!==o||e[2]!==a||e[3]!==f?(p=()=>{a&&o&&!f&&m()},u=[a,m,o,f],e[0]=m,e[1]=o,e[2]=a,e[3]=f,e[4]=p,e[5]=u):(p=e[4],u=e[5]),A.useEffect(p,u),!t){let c;return e[6]===Symbol.for("react.memo_cache_sentinel")?(c=i.jsx(T,{to:"/login"}),e[6]=c):c=e[6],c}if(s){let c;return e[7]===Symbol.for("react.memo_cache_sentinel")?(c=i.jsx("div",{className:"flex w-full max-w-4xl flex-col gap-4 p-4",children:"Loading..."}),e[7]=c):c=e[7],c}let l;e[8]!==t?(l=t&&i.jsx(V,{className:"fixed bottom-4 left-4 z-50"}),e[8]=t,e[9]=l):l=e[9];let y;e[10]===Symbol.for("react.memo_cache_sentinel")?(y=i.jsx("h1",{className:"text-2xl font-bold",children:"My Algorithms"}),e[10]=y):y=e[10];let h;e[11]!==d?.pages?(h=d?.pages.map(te),e[11]=d?.pages,e[12]=h):h=e[12];let n;e[13]!==h?(n=i.jsxs("div",{className:"flex w-full max-w-4xl flex-col gap-4 p-4",children:[y,i.jsx(M,{children:h})]}),e[13]=h,e[14]=n):n=e[14];let g;e[15]!==d?.pages||e[16]!==o||e[17]!==f?(g=f?i.jsx("div",{children:"Loading more..."}):o?i.jsx("div",{children:"Load more"}):d?.pages[0].length===0?i.jsx("div",{className:"text-center text-gray-500",children:"You haven't created any algorithms yet."}):i.jsx("div",{children:"No more algorithms"}),e[15]=d?.pages,e[16]=o,e[17]=f,e[18]=g):g=e[18];let x;e[19]!==r||e[20]!==g?(x=i.jsx("div",{ref:r,className:"py-4 text-center",children:g}),e[19]=r,e[20]=g,e[21]=x):x=e[21];let j;return e[22]!==l||e[23]!==n||e[24]!==x?(j=i.jsxs(i.Fragment,{children:[l,n,x]}),e[22]=l,e[23]=n,e[24]=x,e[25]=j):j=e[25],j}function te(e){return e.map(ie)}function ie(e){return i.jsx(L.div,{initial:{opacity:1,filter:"blur(0px)"},exit:{opacity:0,filter:"blur(4px)",transition:{duration:.3,ease:"easeInOut"}},layout:!0,children:i.jsx(H,{algorithm:e})},e.id)}const je=ee;export{je as component};
