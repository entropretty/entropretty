/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const ue=Symbol("Comlink.proxy"),ke=Symbol("Comlink.endpoint"),Se=Symbol("Comlink.releaseProxy"),q=Symbol("Comlink.finalizer"),O=Symbol("Comlink.thrown"),le=e=>typeof e=="object"&&e!==null||typeof e=="function",Ie={canHandle:e=>le(e)&&e[ue],serialize(e){const{port1:t,port2:r}=new MessageChannel;return Y(e,t),[r,[r]]},deserialize(e){return e.start(),Pe(e)}},Ue={canHandle:e=>le(e)&&O in e,serialize({value:e}){let t;return e instanceof Error?t={isError:!0,value:{message:e.message,name:e.name,stack:e.stack}}:t={isError:!1,value:e},[t,[]]},deserialize(e){throw e.isError?Object.assign(new Error(e.value.message),e.value):e.value}},fe=new Map([["proxy",Ie],["throw",Ue]]);function Te(e,t){for(const r of e)if(t===r||r==="*"||r instanceof RegExp&&r.test(t))return!0;return!1}function Y(e,t=globalThis,r=["*"]){t.addEventListener("message",function n(l){if(!l||!l.data)return;if(!Te(r,l.origin)){console.warn(`Invalid origin '${l.origin}' for comlink proxy`);return}const{id:c,type:h,path:s}=Object.assign({path:[]},l.data),a=(l.data.argumentList||[]).map(T);let d;try{const b=s.slice(0,-1).reduce((m,x)=>m[x],e),y=s.reduce((m,x)=>m[x],e);switch(h){case"GET":d=y;break;case"SET":b[s.slice(-1)[0]]=T(l.data.value),d=!0;break;case"APPLY":d=y.apply(b,a);break;case"CONSTRUCT":{const m=new y(...a);d=Be(m)}break;case"ENDPOINT":{const{port1:m,port2:x}=new MessageChannel;Y(e,x),d=W(m,[m])}break;case"RELEASE":d=void 0;break;default:return}}catch(b){d={value:b,[O]:0}}Promise.resolve(d).catch(b=>({value:b,[O]:0})).then(b=>{const[y,m]=R(b);t.postMessage(Object.assign(Object.assign({},y),{id:c}),m),h==="RELEASE"&&(t.removeEventListener("message",n),he(t),q in e&&typeof e[q]=="function"&&e[q]())}).catch(b=>{const[y,m]=R({value:new TypeError("Unserializable return value"),[O]:0});t.postMessage(Object.assign(Object.assign({},y),{id:c}),m)})}),t.start&&t.start()}function Me(e){return e.constructor.name==="MessagePort"}function he(e){Me(e)&&e.close()}function Pe(e,t){const r=new Map;return e.addEventListener("message",function(l){const{data:c}=l;if(!c||!c.id)return;const h=r.get(c.id);if(h)try{h(c)}finally{r.delete(c.id)}}),j(e,r,[],t)}function _(e){if(e)throw new Error("Proxy has been released and is not useable")}function de(e){return C(e,new Map,{type:"RELEASE"}).then(()=>{he(e)})}const B=new WeakMap,N="FinalizationRegistry"in globalThis&&new FinalizationRegistry(e=>{const t=(B.get(e)||0)-1;B.set(e,t),t===0&&de(e)});function Ce(e,t){const r=(B.get(t)||0)+1;B.set(t,r),N&&N.register(e,t,e)}function _e(e){N&&N.unregister(e)}function j(e,t,r=[],n=function(){}){let l=!1;const c=new Proxy(n,{get(h,s){if(_(l),s===Se)return()=>{_e(c),de(e),t.clear(),l=!0};if(s==="then"){if(r.length===0)return{then:()=>c};const a=C(e,t,{type:"GET",path:r.map(d=>d.toString())}).then(T);return a.then.bind(a)}return j(e,t,[...r,s])},set(h,s,a){_(l);const[d,b]=R(a);return C(e,t,{type:"SET",path:[...r,s].map(y=>y.toString()),value:d},b).then(T)},apply(h,s,a){_(l);const d=r[r.length-1];if(d===ke)return C(e,t,{type:"ENDPOINT"}).then(T);if(d==="bind")return j(e,t,r.slice(0,-1));const[b,y]=J(a);return C(e,t,{type:"APPLY",path:r.map(m=>m.toString()),argumentList:b},y).then(T)},construct(h,s){_(l);const[a,d]=J(s);return C(e,t,{type:"CONSTRUCT",path:r.map(b=>b.toString()),argumentList:a},d).then(T)}});return Ce(c,e),c}function Oe(e){return Array.prototype.concat.apply([],e)}function J(e){const t=e.map(R);return[t.map(r=>r[0]),Oe(t.map(r=>r[1]))]}const be=new WeakMap;function W(e,t){return be.set(e,t),e}function Be(e){return Object.assign(e,{[ue]:!0})}function R(e){for(const[t,r]of fe)if(r.canHandle(e)){const[n,l]=r.serialize(e);return[{type:"HANDLER",name:t,value:n},l]}return[{type:"RAW",value:e},be.get(e)||[]]}function T(e){switch(e.type){case"HANDLER":return fe.get(e.name).deserialize(e.value);case"RAW":return e.value}}function C(e,t,r,n){return new Promise(l=>{const c=Ne();t.set(c,l),e.start&&e.start(),e.postMessage(Object.assign({id:c},r),n)})}function Ne(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}function ye(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var D,K;function pe(){if(K)return D;K=1;const e="Input must be an string, Buffer or Uint8Array";function t(h){let s;if(h instanceof Uint8Array)s=h;else if(typeof h=="string")s=new TextEncoder().encode(h);else throw new Error(e);return s}function r(h){return Array.prototype.map.call(h,function(s){return(s<16?"0":"")+s.toString(16)}).join("")}function n(h){return(4294967296+h).toString(16).substring(1)}function l(h,s,a){let d=`
`+h+" = ";for(let b=0;b<s.length;b+=2){if(a===32)d+=n(s[b]).toUpperCase(),d+=" ",d+=n(s[b+1]).toUpperCase();else if(a===64)d+=n(s[b+1]).toUpperCase(),d+=n(s[b]).toUpperCase();else throw new Error("Invalid size "+a);b%6===4?d+=`
`+new Array(h.length+4).join(" "):b<s.length-2&&(d+=" ")}console.log(d)}function c(h,s,a){let d=new Date().getTime();const b=new Uint8Array(s);for(let m=0;m<s;m++)b[m]=m%256;const y=new Date().getTime();console.log("Generated random input in "+(y-d)+"ms"),d=y;for(let m=0;m<a;m++){const x=h(b),u=new Date().getTime(),g=u-d;d=u,console.log("Hashed in "+g+"ms: "+x.substring(0,20)+"..."),console.log(Math.round(s/(1<<20)/(g/1e3)*100)/100+" MB PER SECOND")}}return D={normalizeInput:t,toHex:r,debugPrint:l,testSpeed:c},D}var F,X;function Re(){if(X)return F;X=1;const e=pe();function t(f,p,o){const w=f[p]+f[o];let v=f[p+1]+f[o+1];w>=4294967296&&v++,f[p]=w,f[p+1]=v}function r(f,p,o,w){let v=f[p]+o;o<0&&(v+=4294967296);let E=f[p+1]+w;v>=4294967296&&E++,f[p]=v,f[p+1]=E}function n(f,p){return f[p]^f[p+1]<<8^f[p+2]<<16^f[p+3]<<24}function l(f,p,o,w,v,E){const A=d[v],k=d[v+1],M=d[E],Ae=d[E+1];t(a,f,p),r(a,f,A,k);let S=a[w]^a[f],I=a[w+1]^a[f+1];a[w]=I,a[w+1]=S,t(a,o,w),S=a[p]^a[o],I=a[p+1]^a[o+1],a[p]=S>>>24^I<<8,a[p+1]=I>>>24^S<<8,t(a,f,p),r(a,f,M,Ae),S=a[w]^a[f],I=a[w+1]^a[f+1],a[w]=S>>>16^I<<16,a[w+1]=I>>>16^S<<16,t(a,o,w),S=a[p]^a[o],I=a[p+1]^a[o+1],a[p]=I>>>31^S<<1,a[p+1]=S>>>31^I<<1}const c=new Uint32Array([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),h=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3],s=new Uint8Array(h.map(function(f){return f*2})),a=new Uint32Array(32),d=new Uint32Array(32);function b(f,p){let o=0;for(o=0;o<16;o++)a[o]=f.h[o],a[o+16]=c[o];for(a[24]=a[24]^f.t,a[25]=a[25]^f.t/4294967296,p&&(a[28]=~a[28],a[29]=~a[29]),o=0;o<32;o++)d[o]=n(f.b,4*o);for(o=0;o<12;o++)l(0,8,16,24,s[o*16+0],s[o*16+1]),l(2,10,18,26,s[o*16+2],s[o*16+3]),l(4,12,20,28,s[o*16+4],s[o*16+5]),l(6,14,22,30,s[o*16+6],s[o*16+7]),l(0,10,20,30,s[o*16+8],s[o*16+9]),l(2,12,22,24,s[o*16+10],s[o*16+11]),l(4,14,16,26,s[o*16+12],s[o*16+13]),l(6,8,18,28,s[o*16+14],s[o*16+15]);for(o=0;o<16;o++)f.h[o]=f.h[o]^a[o]^a[o+16]}const y=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);function m(f,p,o,w){if(f===0||f>64)throw new Error("Illegal output length, expected 0 < length <= 64");if(p&&p.length>64)throw new Error("Illegal key, expected Uint8Array with 0 < length <= 64");if(o&&o.length!==16)throw new Error("Illegal salt, expected Uint8Array with length is 16");if(w&&w.length!==16)throw new Error("Illegal personal, expected Uint8Array with length is 16");const v={b:new Uint8Array(128),h:new Uint32Array(16),t:0,c:0,outlen:f};y.fill(0),y[0]=f,p&&(y[1]=p.length),y[2]=1,y[3]=1,o&&y.set(o,32),w&&y.set(w,48);for(let E=0;E<16;E++)v.h[E]=c[E]^n(y,E*4);return p&&(x(v,p),v.c=128),v}function x(f,p){for(let o=0;o<p.length;o++)f.c===128&&(f.t+=f.c,b(f,!1),f.c=0),f.b[f.c++]=p[o]}function u(f){for(f.t+=f.c;f.c<128;)f.b[f.c++]=0;b(f,!0);const p=new Uint8Array(f.outlen);for(let o=0;o<f.outlen;o++)p[o]=f.h[o>>2]>>8*(o&3);return p}function g(f,p,o,w,v){o=o||64,f=e.normalizeInput(f),w&&(w=e.normalizeInput(w)),v&&(v=e.normalizeInput(v));const E=m(o,p,w,v);return x(E,f),u(E)}function i(f,p,o,w,v){const E=g(f,p,o,w,v);return e.toHex(E)}return F={blake2b:g,blake2bHex:i,blake2bInit:m,blake2bUpdate:x,blake2bFinal:u},F}var L,Z;function ze(){if(Z)return L;Z=1;const e=pe();function t(u,g){return u[g]^u[g+1]<<8^u[g+2]<<16^u[g+3]<<24}function r(u,g,i,f,p,o){h[u]=h[u]+h[g]+p,h[f]=n(h[f]^h[u],16),h[i]=h[i]+h[f],h[g]=n(h[g]^h[i],12),h[u]=h[u]+h[g]+o,h[f]=n(h[f]^h[u],8),h[i]=h[i]+h[f],h[g]=n(h[g]^h[i],7)}function n(u,g){return u>>>g^u<<32-g}const l=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),c=new Uint8Array([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0]),h=new Uint32Array(16),s=new Uint32Array(16);function a(u,g){let i=0;for(i=0;i<8;i++)h[i]=u.h[i],h[i+8]=l[i];for(h[12]^=u.t,h[13]^=u.t/4294967296,g&&(h[14]=~h[14]),i=0;i<16;i++)s[i]=t(u.b,4*i);for(i=0;i<10;i++)r(0,4,8,12,s[c[i*16+0]],s[c[i*16+1]]),r(1,5,9,13,s[c[i*16+2]],s[c[i*16+3]]),r(2,6,10,14,s[c[i*16+4]],s[c[i*16+5]]),r(3,7,11,15,s[c[i*16+6]],s[c[i*16+7]]),r(0,5,10,15,s[c[i*16+8]],s[c[i*16+9]]),r(1,6,11,12,s[c[i*16+10]],s[c[i*16+11]]),r(2,7,8,13,s[c[i*16+12]],s[c[i*16+13]]),r(3,4,9,14,s[c[i*16+14]],s[c[i*16+15]]);for(i=0;i<8;i++)u.h[i]^=h[i]^h[i+8]}function d(u,g){if(!(u>0&&u<=32))throw new Error("Incorrect output length, should be in [1, 32]");const i=g?g.length:0;if(g&&!(i>0&&i<=32))throw new Error("Incorrect key length, should be in [1, 32]");const f={h:new Uint32Array(l),b:new Uint8Array(64),c:0,t:0,outlen:u};return f.h[0]^=16842752^i<<8^u,i>0&&(b(f,g),f.c=64),f}function b(u,g){for(let i=0;i<g.length;i++)u.c===64&&(u.t+=u.c,a(u,!1),u.c=0),u.b[u.c++]=g[i]}function y(u){for(u.t+=u.c;u.c<64;)u.b[u.c++]=0;a(u,!0);const g=new Uint8Array(u.outlen);for(let i=0;i<u.outlen;i++)g[i]=u.h[i>>2]>>8*(i&3)&255;return g}function m(u,g,i){i=i||32,u=e.normalizeInput(u);const f=d(i,g);return b(f,u),y(f)}function x(u,g,i){const f=m(u,g,i);return e.toHex(f)}return L={blake2s:m,blake2sHex:x,blake2sInit:d,blake2sUpdate:b,blake2sFinal:y},L}var $,ee;function qe(){if(ee)return $;ee=1;const e=Re(),t=ze();return $={blake2b:e.blake2b,blake2bHex:e.blake2bHex,blake2bInit:e.blake2bInit,blake2bUpdate:e.blake2bUpdate,blake2bFinal:e.blake2bFinal,blake2s:t.blake2s,blake2sHex:t.blake2sHex,blake2sInit:t.blake2sInit,blake2sUpdate:t.blake2sUpdate,blake2sFinal:t.blake2sFinal},$}var De=qe(),Fe=ye(De);function ge(e){if(e instanceof Uint8Array&&e.constructor.name==="Uint8Array")return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")}function Le(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var l=0;l<e.length;l++){var c=e.charAt(l),h=c.charCodeAt(0);if(r[h]!==255)throw new TypeError(c+" is ambiguous");r[h]=l}var s=e.length,a=e.charAt(0),d=Math.log(s)/Math.log(256),b=Math.log(256)/Math.log(s);function y(u){if(u instanceof Uint8Array||(ArrayBuffer.isView(u)?u=new Uint8Array(u.buffer,u.byteOffset,u.byteLength):Array.isArray(u)&&(u=Uint8Array.from(u))),!(u instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(u.length===0)return"";for(var g=0,i=0,f=0,p=u.length;f!==p&&u[f]===0;)f++,g++;for(var o=(p-f)*b+1>>>0,w=new Uint8Array(o);f!==p;){for(var v=u[f],E=0,A=o-1;(v!==0||E<i)&&A!==-1;A--,E++)v+=256*w[A]>>>0,w[A]=v%s>>>0,v=v/s>>>0;if(v!==0)throw new Error("Non-zero carry");i=E,f++}for(var k=o-i;k!==o&&w[k]===0;)k++;for(var M=a.repeat(g);k<o;++k)M+=e.charAt(w[k]);return M}function m(u){if(typeof u!="string")throw new TypeError("Expected String");if(u.length===0)return new Uint8Array;var g=0;if(u[g]!==" "){for(var i=0,f=0;u[g]===a;)i++,g++;for(var p=(u.length-g)*d+1>>>0,o=new Uint8Array(p);u[g];){var w=r[u.charCodeAt(g)];if(w===255)return;for(var v=0,E=p-1;(w!==0||v<f)&&E!==-1;E--,v++)w+=s*o[E]>>>0,o[E]=w%256>>>0,w=w/256>>>0;if(w!==0)throw new Error("Non-zero carry");f=v,g++}if(u[g]!==" "){for(var A=p-f;A!==p&&o[A]===0;)A++;for(var k=new Uint8Array(i+(p-A)),M=i;A!==p;)k[M++]=o[A++];return k}}}function x(u){var g=m(u);if(g)return g;throw new Error(`Non-${t} character`)}return{encode:y,decodeUnsafe:m,decode:x}}var $e=Le,He=$e;class Ve{name;prefix;baseEncode;constructor(t,r,n){this.name=t,this.prefix=r,this.baseEncode=n}encode(t){if(t instanceof Uint8Array)return`${this.prefix}${this.baseEncode(t)}`;throw Error("Unknown type, must be binary type")}}class Ge{name;prefix;baseDecode;prefixCodePoint;constructor(t,r,n){this.name=t,this.prefix=r;const l=r.codePointAt(0);if(l===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=l,this.baseDecode=n}decode(t){if(typeof t=="string"){if(t.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(t)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(t.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(t){return me(this,t)}}class je{decoders;constructor(t){this.decoders=t}or(t){return me(this,t)}decode(t){const r=t[0],n=this.decoders[r];if(n!=null)return n.decode(t);throw RangeError(`Unable to decode multibase string ${JSON.stringify(t)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}function me(e,t){return new je({...e.decoders??{[e.prefix]:e},...t.decoders??{[t.prefix]:t}})}class We{name;prefix;baseEncode;baseDecode;encoder;decoder;constructor(t,r,n,l){this.name=t,this.prefix=r,this.baseEncode=n,this.baseDecode=l,this.encoder=new Ve(t,r,n),this.decoder=new Ge(t,r,l)}encode(t){return this.encoder.encode(t)}decode(t){return this.decoder.decode(t)}}function we({name:e,prefix:t,encode:r,decode:n}){return new We(e,t,r,n)}function z({name:e,prefix:t,alphabet:r}){const{encode:n,decode:l}=He(r,e);return we({prefix:t,name:e,encode:n,decode:c=>ge(l(c))})}function Qe(e,t,r,n){let l=e.length;for(;e[l-1]==="=";)--l;const c=new Uint8Array(l*r/8|0);let h=0,s=0,a=0;for(let d=0;d<l;++d){const b=t[e[d]];if(b===void 0)throw new SyntaxError(`Non-${n} character`);s=s<<r|b,h+=r,h>=8&&(h-=8,c[a++]=255&s>>h)}if(h>=r||(255&s<<8-h)!==0)throw new SyntaxError("Unexpected end of data");return c}function Ye(e,t,r){const n=t[t.length-1]==="=",l=(1<<r)-1;let c="",h=0,s=0;for(let a=0;a<e.length;++a)for(s=s<<8|e[a],h+=8;h>r;)h-=r,c+=t[l&s>>h];if(h!==0&&(c+=t[l&s<<r-h]),n)for(;(c.length*r&7)!==0;)c+="=";return c}function Je(e){const t={};for(let r=0;r<e.length;++r)t[e[r]]=r;return t}function U({name:e,prefix:t,bitsPerChar:r,alphabet:n}){const l=Je(n);return we({prefix:t,name:e,encode(c){return Ye(c,n,r)},decode(c){return Qe(c,l,r,e)}})}U({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});U({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5});U({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5});U({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5});U({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5});U({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5});U({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5});U({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5});U({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});z({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"});z({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});z({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});z({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Ke=xe,te=128,Xe=-128,Ze=Math.pow(2,31);function xe(e,t,r){t=t||[],r=r||0;for(var n=r;e>=Ze;)t[r++]=e&255|te,e/=128;for(;e&Xe;)t[r++]=e&255|te,e>>>=7;return t[r]=e|0,xe.bytes=r-n+1,t}var et=Q,tt=128,re=127;function Q(e,n){var r=0,n=n||0,l=0,c=n,h,s=e.length;do{if(c>=s)throw Q.bytes=0,new RangeError("Could not decode varint");h=e[c++],r+=l<28?(h&re)<<l:(h&re)*Math.pow(2,l),l+=7}while(h>=tt);return Q.bytes=c-n,r}var rt=Math.pow(2,7),nt=Math.pow(2,14),it=Math.pow(2,21),st=Math.pow(2,28),ot=Math.pow(2,35),at=Math.pow(2,42),ct=Math.pow(2,49),ut=Math.pow(2,56),lt=Math.pow(2,63),ft=function(e){return e<rt?1:e<nt?2:e<it?3:e<st?4:e<ot?5:e<at?6:e<ct?7:e<ut?8:e<lt?9:10},ht={encode:Ke,decode:et,encodingLength:ft},ve=ht;function ne(e,t,r=0){return ve.encode(e,t,r),t}function ie(e){return ve.encodingLength(e)}function se(e,t){const r=t.byteLength,n=ie(e),l=n+ie(r),c=new Uint8Array(l+r);return ne(e,c,0),ne(r,c,n),c.set(t,l),new dt(e,r,t,c)}class dt{code;size;digest;bytes;constructor(t,r,n,l){this.code=t,this.size=r,this.digest=n,this.bytes=l}}function bt({name:e,code:t,encode:r}){return new yt(e,t,r)}class yt{name;code;encode;constructor(t,r,n){this.name=t,this.code=r,this.encode=n}digest(t){if(t instanceof Uint8Array){const r=this.encode(t);return r instanceof Uint8Array?se(this.code,r):r.then(n=>se(this.code,n))}else throw Error("Unknown type, must be binary type")}}const{blake2b:pt}=Fe,gt=bt({name:"blake2b-256",code:45600,encode:e=>ge(pt(e,void 0,32))});/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function mt(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name==="Uint8Array"}function wt(e,...t){if(!mt(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error("Uint8Array expected of length "+t+", got length="+e.length)}const xt=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",vt=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function Et(e){if(wt(e),xt)return e.toHex();let t="";for(let r=0;r<e.length;r++)t+=vt[e[r]];return t}var H={exports:{}},oe;function At(){return oe||(oe=1,(function(e){var t=Object.prototype.hasOwnProperty,r="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(r=!1));function l(a,d,b){this.fn=a,this.context=d,this.once=b||!1}function c(a,d,b,y,m){if(typeof b!="function")throw new TypeError("The listener must be a function");var x=new l(b,y||a,m),u=r?r+d:d;return a._events[u]?a._events[u].fn?a._events[u]=[a._events[u],x]:a._events[u].push(x):(a._events[u]=x,a._eventsCount++),a}function h(a,d){--a._eventsCount===0?a._events=new n:delete a._events[d]}function s(){this._events=new n,this._eventsCount=0}s.prototype.eventNames=function(){var d=[],b,y;if(this._eventsCount===0)return d;for(y in b=this._events)t.call(b,y)&&d.push(r?y.slice(1):y);return Object.getOwnPropertySymbols?d.concat(Object.getOwnPropertySymbols(b)):d},s.prototype.listeners=function(d){var b=r?r+d:d,y=this._events[b];if(!y)return[];if(y.fn)return[y.fn];for(var m=0,x=y.length,u=new Array(x);m<x;m++)u[m]=y[m].fn;return u},s.prototype.listenerCount=function(d){var b=r?r+d:d,y=this._events[b];return y?y.fn?1:y.length:0},s.prototype.emit=function(d,b,y,m,x,u){var g=r?r+d:d;if(!this._events[g])return!1;var i=this._events[g],f=arguments.length,p,o;if(i.fn){switch(i.once&&this.removeListener(d,i.fn,void 0,!0),f){case 1:return i.fn.call(i.context),!0;case 2:return i.fn.call(i.context,b),!0;case 3:return i.fn.call(i.context,b,y),!0;case 4:return i.fn.call(i.context,b,y,m),!0;case 5:return i.fn.call(i.context,b,y,m,x),!0;case 6:return i.fn.call(i.context,b,y,m,x,u),!0}for(o=1,p=new Array(f-1);o<f;o++)p[o-1]=arguments[o];i.fn.apply(i.context,p)}else{var w=i.length,v;for(o=0;o<w;o++)switch(i[o].once&&this.removeListener(d,i[o].fn,void 0,!0),f){case 1:i[o].fn.call(i[o].context);break;case 2:i[o].fn.call(i[o].context,b);break;case 3:i[o].fn.call(i[o].context,b,y);break;case 4:i[o].fn.call(i[o].context,b,y,m);break;default:if(!p)for(v=1,p=new Array(f-1);v<f;v++)p[v-1]=arguments[v];i[o].fn.apply(i[o].context,p)}}return!0},s.prototype.on=function(d,b,y){return c(this,d,b,y,!1)},s.prototype.once=function(d,b,y){return c(this,d,b,y,!0)},s.prototype.removeListener=function(d,b,y,m){var x=r?r+d:d;if(!this._events[x])return this;if(!b)return h(this,x),this;var u=this._events[x];if(u.fn)u.fn===b&&(!m||u.once)&&(!y||u.context===y)&&h(this,x);else{for(var g=0,i=[],f=u.length;g<f;g++)(u[g].fn!==b||m&&!u[g].once||y&&u[g].context!==y)&&i.push(u[g]);i.length?this._events[x]=i.length===1?i[0]:i:h(this,x)}return this},s.prototype.removeAllListeners=function(d){var b;return d?(b=r?r+d:d,this._events[b]&&h(this,b)):(this._events=new n,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=r,s.EventEmitter=s,e.exports=s})(H)),H.exports}var kt=At(),St=ye(kt);class Ee extends Error{constructor(t){super(t),this.name="TimeoutError"}}class It extends Error{constructor(t){super(),this.name="AbortError",this.message=t}}const ae=e=>globalThis.DOMException===void 0?new It(e):new DOMException(e),ce=e=>{const t=e.reason===void 0?ae("This operation was aborted."):e.reason;return t instanceof Error?t:ae(t)};function Ut(e,t){const{milliseconds:r,fallback:n,message:l,customTimers:c={setTimeout,clearTimeout}}=t;let h,s;const d=new Promise((b,y)=>{if(typeof r!="number"||Math.sign(r)!==1)throw new TypeError(`Expected \`milliseconds\` to be a positive number, got \`${r}\``);if(t.signal){const{signal:x}=t;x.aborted&&y(ce(x)),s=()=>{y(ce(x))},x.addEventListener("abort",s,{once:!0})}if(r===Number.POSITIVE_INFINITY){e.then(b,y);return}const m=new Ee;h=c.setTimeout.call(void 0,()=>{if(n){try{b(n())}catch(x){y(x)}return}typeof e.cancel=="function"&&e.cancel(),l===!1?b():l instanceof Error?y(l):(m.message=l??`Promise timed out after ${r} milliseconds`,y(m))},r),(async()=>{try{b(await e)}catch(x){y(x)}})()}).finally(()=>{d.clear(),s&&t.signal&&t.signal.removeEventListener("abort",s)});return d.clear=()=>{c.clearTimeout.call(void 0,h),h=void 0},d}function Tt(e,t,r){let n=0,l=e.length;for(;l>0;){const c=Math.trunc(l/2);let h=n+c;r(e[h],t)<=0?(n=++h,l-=c+1):l=c}return n}class Mt{#e=[];enqueue(t,r){r={priority:0,...r};const n={priority:r.priority,id:r.id,run:t};if(this.size===0||this.#e[this.size-1].priority>=r.priority){this.#e.push(n);return}const l=Tt(this.#e,n,(c,h)=>h.priority-c.priority);this.#e.splice(l,0,n)}setPriority(t,r){const n=this.#e.findIndex(c=>c.id===t);if(n===-1)throw new ReferenceError(`No promise function with the id "${t}" exists in the queue.`);const[l]=this.#e.splice(n,1);this.enqueue(l.run,{priority:r,id:t})}dequeue(){return this.#e.shift()?.run}filter(t){return this.#e.filter(r=>r.priority===t.priority).map(r=>r.run)}get size(){return this.#e.length}}class Pt extends St{#e;#o;#s=0;#d;#a;#b=0;#r;#c;#t;#y;#n=0;#u;#i;#p;#w=1n;timeout;constructor(t){if(super(),t={carryoverConcurrencyCount:!1,intervalCap:Number.POSITIVE_INFINITY,interval:0,concurrency:Number.POSITIVE_INFINITY,autoStart:!0,queueClass:Mt,...t},!(typeof t.intervalCap=="number"&&t.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${t.intervalCap?.toString()??""}\` (${typeof t.intervalCap})`);if(t.interval===void 0||!(Number.isFinite(t.interval)&&t.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${t.interval?.toString()??""}\` (${typeof t.interval})`);this.#e=t.carryoverConcurrencyCount,this.#o=t.intervalCap===Number.POSITIVE_INFINITY||t.interval===0,this.#d=t.intervalCap,this.#a=t.interval,this.#t=new t.queueClass,this.#y=t.queueClass,this.concurrency=t.concurrency,this.timeout=t.timeout,this.#p=t.throwOnTimeout===!0,this.#i=t.autoStart===!1}get#x(){return this.#o||this.#s<this.#d}get#v(){return this.#n<this.#u}#E(){this.#n--,this.#l(),this.emit("next")}#A(){this.#m(),this.#g(),this.#c=void 0}get#k(){const t=Date.now();if(this.#r===void 0){const r=this.#b-t;if(r<0)this.#s=this.#e?this.#n:0;else return this.#c===void 0&&(this.#c=setTimeout(()=>{this.#A()},r)),!0}return!1}#l(){if(this.#t.size===0)return this.#r&&clearInterval(this.#r),this.#r=void 0,this.emit("empty"),this.#n===0&&this.emit("idle"),!1;if(!this.#i){const t=!this.#k;if(this.#x&&this.#v){const r=this.#t.dequeue();return r?(this.emit("active"),r(),t&&this.#g(),!0):!1}}return!1}#g(){this.#o||this.#r!==void 0||(this.#r=setInterval(()=>{this.#m()},this.#a),this.#b=Date.now()+this.#a)}#m(){this.#s===0&&this.#n===0&&this.#r&&(clearInterval(this.#r),this.#r=void 0),this.#s=this.#e?this.#n:0,this.#f()}#f(){for(;this.#l(););}get concurrency(){return this.#u}set concurrency(t){if(!(typeof t=="number"&&t>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${t}\` (${typeof t})`);this.#u=t,this.#f()}async#S(t){return new Promise((r,n)=>{t.addEventListener("abort",()=>{n(t.reason)},{once:!0})})}setPriority(t,r){this.#t.setPriority(t,r)}async add(t,r={}){return r.id??=(this.#w++).toString(),r={timeout:this.timeout,throwOnTimeout:this.#p,...r},new Promise((n,l)=>{this.#t.enqueue(async()=>{this.#n++,this.#s++;try{r.signal?.throwIfAborted();let c=t({signal:r.signal});r.timeout&&(c=Ut(Promise.resolve(c),{milliseconds:r.timeout})),r.signal&&(c=Promise.race([c,this.#S(r.signal)]));const h=await c;n(h),this.emit("completed",h)}catch(c){if(c instanceof Ee&&!r.throwOnTimeout){n();return}l(c),this.emit("error",c)}finally{this.#E()}},r),this.emit("add"),this.#l()})}async addAll(t,r){return Promise.all(t.map(async n=>this.add(n,r)))}start(){return this.#i?(this.#i=!1,this.#f(),this):this}pause(){this.#i=!0}clear(){this.#t=new this.#y}async onEmpty(){this.#t.size!==0&&await this.#h("empty")}async onSizeLessThan(t){this.#t.size<t||await this.#h("next",()=>this.#t.size<t)}async onIdle(){this.#n===0&&this.#t.size===0||await this.#h("idle")}async#h(t,r){return new Promise(n=>{const l=()=>{r&&!r()||(this.off(t,l),n())};this.on(t,l)})}get size(){return this.#t.size}sizeBy(t){return this.#t.filter(t).length}get pending(){return this.#n}get isPaused(){return this.#i}}var V=_t(1,2,3,4);function Ct(e){return{Procedural:G(4,V),ProceduralPersonal:[0,0,0,0,0,0,0,...G(1,V)],ProceduralAccount:G(32,V)}[e]}function G(e,t){const r=Array(e).fill(0);for(let n=0;n<e;n++)r[n]=Math.floor(t()*255);return r}function _t(e,t,r,n){return function(){e|=0,t|=0,r|=0,n|=0;const l=(e+t|0)+n|0;return n=n+1|0,e=t^t>>>9,t=r+(r<<3)|0,r=r<<21|r>>>11,r=r+l|0,(l>>>0)/4294967296}}var Ot=`
  const black = "#000000"
  const white = "#fff"
  const light = "#aaa"
  const dark = "#666"

  function getByte(seed, index) {
  return seed[index % seed.length];
}
  function split(seed, parts) {
  const r = [];
  let last = 0;
  for (let i = 0;i < parts; ++i) {
    const next = Math.round((i + 1) * 32 / parts);
    r.push(bits(seed, last, next));
    last = next;
  }
  return r;
}
  function bytesToNibbles(bytes) {
  const nibbles = new Array(bytes.length * 2);
  for (let i = 0;i < bytes.length; i++) {
    const byte = getByte(bytes, i);
    nibbles[i * 2] = byte >> 4 & 15;
    nibbles[i * 2 + 1] = byte & 15;
  }
  return nibbles;
}
  function bit(seed, i) {
  return getByte(seed, Math.floor(i / 8)) >> i % 8 & 1;
}
  function bits(seed, from = 0, to = 32) {
  let r = 0;
  for (let i = from;i < to; ++i)
    r = (r << 1 | bit(seed, i)) >>> 0;
  return r;
}
  function symmetrical(factor, fn, ctx) {
  ctx.translate(50, 50);
  ctx.scale(50, 50);
  for (let i = 0;i < factor; ++i) {
    ctx.save();
    ctx.rotate(Math.PI * 2 * i / factor);
    fn(i);
    ctx.restore();
  }
}
  function strokeEach(array, fn, ctx) {
  array.forEach((element, index) => {
    ctx.beginPath();
    fn(element, index);
    ctx.stroke();
  });
}
  function fillEach(array, fn, ctx) {
  array.forEach((element, index) => {
    ctx.beginPath();
    fn(element, index);
    ctx.fill();
  });
}
  function numeric(seed) {
  if (seed.length > 64)
    throw "Seed too long to safely convert to a bigint";
  let result = 0n;
  for (let i = 0;i < seed.length; i++)
    result = result << 8n | BigInt(getByte(seed, i));
  return result;
}
  function randomGenerator(seed) {
  let a = bits(seed), b = bits(seed), c = bits(seed), d = bits(seed);
  return () => {
    const t = a + b | 0;
    a = b ^ b >>> 9;
    b = c + (c << 3) | 0;
    c = c << 21 | c >>> 11;
    d = d + 1 | 0;
    return ((t + d | 0) >>> 0) / 4294967296;
  };
}
  function sfc32(a, b, c, d) {
  return () => {
    a |= 0;
    b |= 0;
    c |= 0;
    d |= 0;
    const t = (a + b | 0) + d | 0;
    d = d + 1 | 0;
    a = b ^ b >>> 9;
    b = c + (c << 3) | 0;
    c = c << 21 | c >>> 11;
    c = c + t | 0;
    return (t >>> 0) / 4294967296;
  };
}
  function bytesToBits(bytes) {
  const bits = new Array(bytes.length * 8);
  for (let i = 0;i < bytes.length; i++) {
    const byte = getByte(bytes, i);
    bits[i * 8] = byte >> 7 & 1;
    bits[i * 8 + 1] = byte >> 6 & 1;
    bits[i * 8 + 2] = byte >> 5 & 1;
    bits[i * 8 + 3] = byte >> 4 & 1;
    bits[i * 8 + 4] = byte >> 3 & 1;
    bits[i * 8 + 5] = byte >> 2 & 1;
    bits[i * 8 + 6] = byte >> 1 & 1;
    bits[i * 8 + 7] = byte & 1;
  }
  return bits;
}
  function bytesToQuarterBytes(bytes) {
  const quarterBytes = new Array(bytes.length * 4);
  for (let i = 0;i < bytes.length; i++) {
    const byte = getByte(bytes, i);
    quarterBytes[i * 4] = byte >> 6 & 3;
    quarterBytes[i * 4 + 1] = byte >> 4 & 3;
    quarterBytes[i * 4 + 2] = byte >> 2 & 3;
    quarterBytes[i * 4 + 3] = byte & 3;
  }
  return quarterBytes;
}
  function map(value, inputStart, inputStop, outputStart, outputStop, withinBounds = !0) {
  const result = outputStart + (outputStop - outputStart) * ((value - inputStart) / (inputStop - inputStart));
  if (!withinBounds)
    return result;
  const minOutput = Math.min(outputStart, outputStop), maxOutput = Math.max(outputStart, outputStop);
  return Math.max(minOutput, Math.min(maxOutput, result));
}
`,Bt=class{constructor(e=300){this.timeoutMs=e,this.queue=new Pt({concurrency:4})}algorithms=new Map;metadata=new Map;queue;updateAlgorithm(e,t,r){this.algorithms.set(e,t),this.metadata.set(e,r)}async testRender(e){if(!this.algorithms.get(e))throw new Error(`No script found for algorithm ${e}`);const r=this.metadata.get(e);if(!r)throw new Error(`No kind found for algorithm ${e}`);const n=Ct(r);await this.render(e,50,n)}async render(e,t,r,n={output:"bitmap"}){const l=this.algorithms.get(e);if(!l)throw new Error(`No script found for algorithm ${e}`);return this.queue.add(()=>this.drawWithTimeout(l,t,[...r],n.output))}async renderBitmap(e,t,r){return this.render(e,t,r,{output:"bitmap"})}async renderImageData(e,t,r){return this.render(e,t,r,{output:"imagedata"})}async hash(e,t,r){const n=await this.renderImageData(e,t,r),l=new ArrayBuffer(n.data.length);new Uint8Array(l).set(n.data);const c=await gt.digest(new Uint8Array(l));return Et(c.digest)}cancelPending(){this.queue.clear()}getAlgorithmMeta(e){const t=this.metadata.get(e);if(t)return{kind:t}}getAlgorithm(e){return this.algorithms.get(e)}async drawWithTimeout(e,t,r,n){const l=new OffscreenCanvas(t,t),c=l.getContext("2d");if(!c)throw new Error("Failed to get 2D rendering context");const h=new Promise((a,d)=>setTimeout(()=>d(new Error(`Render timed out after ${this.timeoutMs}ms`)),this.timeoutMs)),s=(async()=>{try{c.scale(l.width/100,l.width/100),c.lineWidth=1,c.lineCap="butt",c.lineJoin="miter",c.strokeStyle="black",c.fillStyle="black",c.textAlign="center",c.textBaseline="bottom";let a;try{a=new Function("ctx","seed",`${Ot}
${e}`)}catch(d){throw d instanceof SyntaxError?new Error(`Syntax error: ${d.message}`):new Error(`Syntax error: ${d}`)}try{a(c,[...r])}catch(d){throw new Error(`Runtime error: ${d}`)}return n==="imagedata"?c.getImageData(0,0,t,t):l.transferToImageBitmap()}catch(a){throw a}})();return await Promise.race([s,h])}};const P=new Bt(300),Nt={async updateAlgorithm(e,t,r){return P.updateAlgorithm(e,t,r)},async render(e,t,r){const n=await P.render(e,t,r);return W(n,[n])},async renderBitmap(e,t,r){const n=await P.renderBitmap(e,t,r);return W(n,[n])},async testRender(e){return P.testRender(e)},cancelPending(){P.cancelPending()},getAlgorithmMeta(e){return P.getAlgorithmMeta(e)}};Y(Nt);
