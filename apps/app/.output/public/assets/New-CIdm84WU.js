import{f as j,s as N,c as y,u as _,j as t,r as v}from"./main-D_QOtJ75.js";import{A,a as p}from"./AlgorithmCardSkeleton-BfKjjmlv.js";import{f as F,F as P}from"./FamilyKindFilter-B-AytEWE.js";import{F as w}from"./index-B8xx3lLY.js";import{u as E}from"./useInfiniteQuery-it1EuC-d.js";import{u as S}from"./react-R1SzaRUi.js";import{u as b}from"./index-DFufhFO-.js";const x=3;function k(){const e=j(),r=S(F);return E({queryKey:["algorithms","latest",r],initialPageParam:0,queryFn:async({pageParam:s})=>{const i=s*x,l=i+x-1;let n=N.from("algorithms_with_user_profile").select().order("created_at",{ascending:!1});r!=="All"&&(n=n.eq("family_kind",r));const{data:a,error:o}=await n.range(i,l);if(a!==null)for(const m of a)e.addAlgorithm(m.id,m.content,m.family_kind);if(o)throw o;return a},getNextPageParam:(s,i)=>s.length===x?i.length:void 0})}function q(){const e=y.c(18),{ref:r,inView:s}=b(),{data:i,isLoading:l,fetchNextPage:n,hasNextPage:a,isFetchingNextPage:o}=k();let m,u;if(e[0]!==n||e[1]!==a||e[2]!==s||e[3]!==o?(m=()=>{s&&a&&!o&&n()},u=[s,n,a,o],e[0]=n,e[1]=a,e[2]=s,e[3]=o,e[4]=m,e[5]=u):(m=e[4],u=e[5]),v.useEffect(m,u),l){let h;return e[6]===Symbol.for("react.memo_cache_sentinel")?(h=t.jsxs("div",{className:"space-y-4",children:[t.jsx(p,{}),t.jsx(p,{})]}),e[6]=h):h=e[6],h}let c;e[7]!==i?.pages?(c=i?.pages.map(K),e[7]=i?.pages,e[8]=c):c=e[8];let f;e[9]!==a||e[10]!==o?(f=o?t.jsx("div",{children:"Loading more..."}):a?t.jsx("div",{children:"Load more"}):t.jsx("div",{children:"No more algorithms"}),e[9]=a,e[10]=o,e[11]=f):f=e[11];let d;e[12]!==r||e[13]!==f?(d=t.jsx("div",{ref:r,className:"py-4 text-center",children:f}),e[12]=r,e[13]=f,e[14]=d):d=e[14];let g;return e[15]!==c||e[16]!==d?(g=t.jsxs("div",{className:"space-y-4",children:[c,d]}),e[15]=c,e[16]=d,e[17]=g):g=e[17],g}function K(e){return e.map(L)}function L(e){return t.jsx(A,{algorithm:e},e.id)}function G(){const e=y.c(5),{user:r}=_();let s;e[0]!==r?(s=r&&t.jsx(w,{className:"fixed bottom-4 left-4 z-50"}),e[0]=r,e[1]=s):s=e[1];let i;e[2]===Symbol.for("react.memo_cache_sentinel")?(i=t.jsx("div",{className:"mx-auto my-4",children:t.jsxs("div",{className:"space-y-4",children:[t.jsx(P,{}),t.jsx(q,{})]})}),e[2]=i):i=e[2];let l;return e[3]!==s?(l=t.jsxs(t.Fragment,{children:[s,i]}),e[3]=s,e[4]=l):l=e[4],l}export{G as N};
