import{u as A,g as $,r as C,s as L,t as w,j as i,c as j,L as p}from"./main-D_QOtJ75.js";import{u as E}from"./useAlgorithm-XwL09dTX.js";import{F as S}from"./FamilyKindBadge-rjTMkzGm.js";import{B as v}from"./button-BnWcWO71.js";import{A as z}from"./AlgorithmBitmap-CUFHLwpA.js";import{u as D,S as F}from"./useDisplaySizes-DoYTHURn.js";import{a as k,s as B}from"./index-BzRZEjlo.js";import{u as Q}from"./useUsersLikes-BZbDMPmT.js";import{c as q}from"./utils-CjfV1Qjd.js";import{c as I}from"./createLucideIcon-4ydf6LMZ.js";/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R=[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z",key:"1fy3hk"}]],K=I("bookmark",R);function O({algorithm:d}){const{user:e}=A(),{data:s,isLoading:c}=Q(),o=$(),t=s?.includes(d.id),r=C.useCallback(async()=>{if(!e)return;const l=["user-likes",e.id],a=o.getQueryData(l)??[];if(t){o.setQueryData(l,a.filter(m=>m!==d.id));const{error:n}=await L.from("likes").delete().eq("algorithm_id",d.id).eq("user_id",e.id);n&&(o.setQueryData(l,a),console.error("Error unliking algorithm:",n),w.error("Error Unliking Algorithm: "+n.message))}else{o.setQueryData(l,[...a,d.id]);const{error:n}=await L.from("likes").insert([{algorithm_id:d.id,user_id:e.id}]);n&&(o.setQueryData(l,a),console.error("Error liking algorithm:",n),w.error("Error Liking Algorithm: "+n.message))}},[d,e,o,t]);return c?null:i.jsx("div",{className:"flex flex-row items-center justify-center gap-2",children:i.jsxs(v,{size:"sm",variant:"ghost",onClick:r,className:q({"bg-foreground text-background hover:bg-foreground/90 hover:text-background":t,"pointer-events-none":!e||c}),children:[t&&i.jsx(K,{className:"h-3 w-3",strokeLinecap:"square",fill:"currentColor",strokeLinejoin:"miter"}),i.jsx("span",{className:"flex items-center",children:e&&t?"COLLECTED":"COLLECT"})]})})}const U=d=>{const e=j.c(17),{algorithm:s}=d,c=`${s.name||"Untitled"} `,o=`/a/${s.id}`,t=`/a/${s.id}`;let r;e[0]!==o||e[1]!==t?(r=i.jsx(p,{className:"text-muted-foreground underline",to:o,children:t}),e[0]=o,e[1]=t,e[2]=r):r=e[2];let l;e[3]!==c||e[4]!==r?(l=i.jsxs("span",{children:[c,r]}),e[3]=c,e[4]=r,e[5]=l):l=e[5];let a;e[6]!==s.remix_of?(a=s.remix_of&&i.jsxs(i.Fragment,{children:[" remix of ",i.jsx(p,{className:"text-muted-foreground underline",to:`/a/${s.remix_of}`,children:`/a/${s.remix_of}`})]}),e[6]=s.remix_of,e[7]=a):a=e[7];let n;e[8]!==l||e[9]!==a?(n=i.jsxs("div",{children:[l,a]}),e[8]=l,e[9]=a,e[10]=n):n=e[10];const m=`/u/${s.username||"Anonymous"}`,x=s.username||"Anonymous";let f;e[11]!==m||e[12]!==x?(f=i.jsxs("div",{children:["by ",i.jsx(p,{className:"text-muted-foreground underline",to:m,children:x})]}),e[11]=m,e[12]=x,e[13]=f):f=e[13];let u;return e[14]!==f||e[15]!==n?(u=i.jsxs("div",{className:"flex flex-col text-xs text-gray-600",children:[n,f]}),e[14]=f,e[15]=n,e[16]=u):u=e[16],u};function T(d){const e=j.c(32),{algorithm:s}=d,{grid:c}=D();let o;e[0]!==s.family_kind?(o=k(s.family_kind).slice(0,3),e[0]=s.family_kind,e[1]=o):o=e[1];let t;e[2]!==s.family_kind?(t=k(s.family_kind).slice(0,3),e[2]=s.family_kind,e[3]=t):t=e[3];let r;e[4]!==s.family_kind?(r=k(s.family_kind).slice(0,3),e[4]=s.family_kind,e[5]=r):r=e[5];let l;e[6]!==o||e[7]!==t||e[8]!==r?(l=[...o,...t,...r],e[6]=o,e[7]=t,e[8]=r,e[9]=l):l=e[9];const[a,n]=C.useState(l);if(!s.id)return null;const m=`/a/${s.id}`;let x;if(e[10]!==s.id||e[11]!==c||e[12]!==a){let b;e[14]!==s.id||e[15]!==c?(b=N=>i.jsx(z,{algorithmId:s.id,seed:N,size:c,scale:2},B(N)),e[14]=s.id,e[15]=c,e[16]=b):b=e[16],x=a.slice(0,9).map(b),e[10]=s.id,e[11]=c,e[12]=a,e[13]=x}else x=e[13];let f;e[17]!==x?(f=i.jsx("div",{className:"z-100 relative flex flex-col items-center justify-center gap-4 p-4 transition-colors md:flex-row",children:i.jsx("div",{className:"flex h-full w-full items-center justify-center",children:i.jsx("div",{className:"grid grid-cols-3 items-center justify-center gap-4",children:x})})}),e[17]=x,e[18]=f):f=e[18];let u;e[19]!==m||e[20]!==f?(u=i.jsx(p,{to:m,children:f}),e[19]=m,e[20]=f,e[21]=u):u=e[21];let g;e[22]!==s.family_kind?(g=i.jsx(S,{familyKind:s.family_kind,className:"absolute left-0 top-[-22px]"}),e[22]=s.family_kind,e[23]=g):g=e[23];let h;e[24]!==s?(h=i.jsxs("div",{className:"relative flex flex-col items-start justify-between gap-y-2",children:[i.jsx(U,{algorithm:s}),i.jsx(G,{algorithm:s,setSeedFamily:n})]}),e[24]=s,e[25]=h):h=e[25];let y;e[26]!==h||e[27]!==g?(y=i.jsxs("div",{className:"bg-background absolute bottom-0 w-full border-t border-black/30 px-4 py-2 opacity-0 transition-opacity group-hover:opacity-100 group-hover:[box-shadow:4px_4px_0_0_rgba(0,0,0,0.5)] hover:dark:[box-shadow:4px_4px_0_0_rgba(255,255,255,0.5)]",children:[g,h]}),e[26]=h,e[27]=g,e[28]=y):y=e[28];let _;return e[29]!==y||e[30]!==u?(_=i.jsxs("div",{className:"border-background-200 hover:border-foreground/30 group relative flex w-full flex-col border",children:[u,y]}),e[29]=y,e[30]=u,e[31]=_):_=e[31],_}const G=d=>{const e=j.c(14),{algorithm:s,setSeedFamily:c}=d,{user:o}=A();let t;e[0]!==s.family_kind||e[1]!==c?(t=()=>{c([...k(s.family_kind).slice(0,3),...k(s.family_kind).slice(0,3),...k(s.family_kind).slice(0,3)])},e[0]=s.family_kind,e[1]=c,e[2]=t):t=e[2];const r=t;let l;e[3]!==r?(l=i.jsx(v,{variant:"ghost",size:"sm",onClick:r,className:"select-none",children:"REROLL"}),e[3]=r,e[4]=l):l=e[4];let a;e[5]!==s.id||e[6]!==o?(a=o&&i.jsx(v,{asChild:!0,variant:"link",size:"sm",className:"select-none",children:i.jsx(p,{to:`/create?remix=${s.id}`,children:"REMIX"})}),e[5]=s.id,e[6]=o,e[7]=a):a=e[7];let n;e[8]!==s?(n=i.jsx("div",{className:"hidden select-none md:block",children:i.jsx(O,{algorithm:s})}),e[8]=s,e[9]=n):n=e[9];let m;return e[10]!==l||e[11]!==a||e[12]!==n?(m=i.jsxs("div",{className:"flex w-full flex-row items-center justify-center gap-2",children:[l,a,n]}),e[10]=l,e[11]=a,e[12]=n,e[13]=m):m=e[13],m};function M(){const d=j.c(1);let e;return d[0]===Symbol.for("react.memo_cache_sentinel")?(e=i.jsx(F,{className:"flex h-[364px] w-[364px] rounded-none"}),d[0]=e):e=d[0],e}const ie=d=>{const e=j.c(3),{algorithmId:s}=d,{data:c,isLoading:o}=E(s);if(o){let r;return e[0]===Symbol.for("react.memo_cache_sentinel")?(r=i.jsx(M,{}),e[0]=r):r=e[0],r}let t;return e[1]!==c?(t=i.jsx(T,{algorithm:c}),e[1]=c,e[2]=t):t=e[2],t};export{ie as G};
